
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Program in YAML — Code is Data">
      
      
        <meta name="author" content="{'name': 'Ingy döt Net', 'url': '/about/#ingydotnet'}">
      
      
        <link rel="canonical" href="https://yamlscript.org/blog/advent-2023/dec-10/">
      
      
        <link rel="prev" href="../dec-11/">
      
      
        <link rel="next" href="../dec-09/">
      
      
      <link rel="icon" href="../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>States and Ladders - YS is the new YAML</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/theme.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#welcome-to-day-10-of-the-yamlscript-advent-calendar" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="YS is the new YAML" class="md-header__button md-logo" aria-label="YS is the new YAML" data-md-component="logo">
      
  <img src="../../../images/yamlscript-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            YS is the new YAML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              States and Ladders
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/yaml/yamlscript" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../doc/intro/" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../doc/extending.md" class="md-tabs__link">
          
  
    
  
  Use Cases

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../doc/about.md" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../doc/yaml/" class="md-tabs__link">
          
  
    
  
  Gallery

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../community/chat.md" class="md-tabs__link">
          
  
    
  
  Community

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../2024-11-29/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../news.md" class="md-tabs__link">
          
  
    
  
  News

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="YS is the new YAML" class="md-nav__button md-logo" aria-label="YS is the new YAML" data-md-component="logo">
      
  <img src="../../../images/yamlscript-logo.svg" alt="logo">

    </a>
    YS is the new YAML
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/yaml/yamlscript" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About YS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/yaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAML is YS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The ys Command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/loaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS YAML Loaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Use Cases
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Use Cases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/extending.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending YAML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/scripting.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS Scripting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    What is YS?
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            What is YS?
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/about.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/features.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gallery
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Gallery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/yaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAML is YS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/exercism.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS on Exercism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/rosetta.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS on Rosetta Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/jsonnet.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS for Jsonnet Users
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/cue.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS for Cue Users
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/hcl.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS for HCL Users
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/jinja2.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS for Jinja2 Users
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/python.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS for Python Programmers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/clojure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS for Clojure Programmers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Community
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Community
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../community/chat.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../community/github.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../community/stackoverflow.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stack Overflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../community/twitter.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Twitter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-11-29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Kubernetes Effect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-11-05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Fall of YAMLScript!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-07-17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Go Julia!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-06-20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dr. StangeYAML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Older
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Older
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-04-16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAMLScript Spring Update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-03-14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAMLScript Firsts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" checked>
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2023 Advent Posts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            2023 Advent Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wrapped and Ready
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perl to Rust
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flip Flops
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAML, Python and the Holy Graal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Godspeed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reindeer All The Way Down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Santa's in d'buggy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rosetta Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Let Lambda Come Over
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Naughty is Nice!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stocking Stuffers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    History Lesson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Future Proof
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The YeS Express
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    States and Ladders
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    States and Ladders
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#welcome-to-day-10-of-the-yamlscript-advent-calendar" class="md-nav__link">
    <span class="md-ellipsis">
      Welcome to Day 10 of the YAMLScript Advent Calendar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-1-parse" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 1: Parse
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-2-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 2: Compose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-3-resolve" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 3: Resolve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-4-build" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 4: Build
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-5-transform" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 5: Transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-6-construct" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 6: Construct
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-7-print" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 7: Print
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-1-7-compile" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 1-7: Compile
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding with Style
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Going to the Library
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-07/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sharpen Your Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-06/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modes of Transportation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unwrapping Gifts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Santa's Big Secret
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load em Up!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Twas a Bit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dec-01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAMLScript Advent 2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    News
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            News
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../news.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS News
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YS Releases
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#welcome-to-day-10-of-the-yamlscript-advent-calendar" class="md-nav__link">
    <span class="md-ellipsis">
      Welcome to Day 10 of the YAMLScript Advent Calendar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-1-parse" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 1: Parse
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-2-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 2: Compose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-3-resolve" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 3: Resolve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-4-build" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 4: Build
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-5-transform" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 5: Transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-6-construct" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 6: Construct
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-7-print" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 7: Print
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-1-7-compile" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation 1-7: Compile
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
<!--
<pre>
page: >>><<<
page.meta: >>>{
  "author": {
    "name": "Ingy d\u00f6t Net",
    "url": "/about/#ingydotnet"
  },
  "date": "2023-12-10",
  "permalink": "{{ page.filePathStem }}/",
  "tags": [
    "blog",
    "advent-2023"
  ],
  "title": "States and Ladders"
}<<<
page.previous_page: >>>Page(title='The YeS Express', url='/blog/advent-2023/dec-11/')<<<
page.next_page: >>>Page(title='Coding with Style', url='/blog/advent-2023/dec-09/')<<<
scheme: >>>default<<<
tag: >>><<<
title: >>><<<
app: >>><<<
author: >>><<<
</pre>
-->




  <h1>States and Ladders</h1>

<p>Santa is a busy guy.
He has a lot of work to do.
He has to make a list and check it twice.
He has to find out who's naughty and nice.
He has the monumental task of transforming wishes into happiness.</p>
<p>YS only needs to transform YAMLScript into Clojure.
But it's a bit more involved than you might think.</p>
<p>To make things easier the YS compiler breaks the transformation into eight
distinct States and seven distinct ~~Ladders~~ transformations.</p>
<h3 id="welcome-to-day-10-of-the-yamlscript-advent-calendar">Welcome to Day 10 of the YAMLScript Advent Calendar</h3>
<p>Today we're going to learn more exactly how <code>ys --compile</code> turns YAMLScript into
Clojure.<br />
<em>Fair Warning: This is going to be a long post</em>.</p>
<p>The <code>ys</code> CLI has an awesome tool to visualize the transformation process any
time you are interested.
This might be for debugging where something went wrong, or just to learn more
about how the compiler works.</p>
<p>To begin this journey, let's use this visualizer in action.
You could write it like this:</p>
<pre><code class="language-bash">ys --compile --debug-stage=all -e 'name =: &quot;Clojure&quot;' -e 'say: &quot;Hello, $name!&quot;'
</code></pre>
<p>The one line program is equivalent to the file containing:</p>
<pre><code class="language-yaml">!yamlscript/v0
name =: &quot;Clojure&quot;
say: &quot;Hello, $name!&quot;
</code></pre>
<p>Let's run the command now (but we'll use the shorter options):</p>
<pre><code class="language-bash">$ ys -c -e 'name =: &quot;Clojure&quot;' -e 'say: &quot;Hello, $name!&quot;' -d
*** parse     *** 0.127737 ms
({:+ &quot;+MAP&quot;, :! &quot;yamlscript/v0/code&quot;}
 {:+ &quot;=VAL&quot;, := &quot;name =&quot;}
 {:+ &quot;=VAL&quot;, :$ &quot;Clojure&quot;}
 {:+ &quot;=VAL&quot;, := &quot;say&quot;}
 {:+ &quot;=VAL&quot;, :$ &quot;Hello, $name!&quot;}
 {:+ &quot;-MAP&quot;}
 {:+ &quot;-DOC&quot;})

*** compose   *** 0.009495 ms
{:! &quot;yamlscript/v0/code&quot;,
 :% [{:= &quot;name =&quot;} {:$ &quot;Clojure&quot;} {:= &quot;say&quot;} {:$ &quot;Hello, $name!&quot;}]}

*** resolve   *** 0.073969 ms
{:pairs
 [{:def &quot;name =&quot;}
  {:vstr &quot;Clojure&quot;}
  {:exp &quot;say&quot;}
  {:vstr &quot;Hello, $name!&quot;}]}

*** build     *** 0.375378 ms
{:pairs
 [[{:Sym def} {:Sym name}]
  {:Str &quot;Clojure&quot;}
  {:Sym say}
  {:Lst [{:Sym str} {:Str &quot;Hello, &quot;} {:Sym name} {:Str &quot;!&quot;}]}]}

*** transform *** 0.027342 ms
{:pairs
 [[{:Sym def} {:Sym name}]
  {:Str &quot;Clojure&quot;}
  {:Sym say}
  {:Lst [{:Sym str} {:Str &quot;Hello, &quot;} {:Sym name} {:Str &quot;!&quot;}]}]}

*** construct *** 0.087933 ms
{:Top
 [{:Lst [{:Sym def} {:Sym name} {:Str &quot;Clojure&quot;}]}
  {:Lst
   [{:Sym say}
    {:Lst [{:Sym str} {:Str &quot;Hello, &quot;} {:Sym name} {:Str &quot;!&quot;}]}]}]}

*** print     *** 0.014494 ms
&quot;(def name \&quot;Clojure\&quot;)(say (str \&quot;Hello, \&quot; name \&quot;!\&quot;))&quot;

(def name &quot;Clojure&quot;)
(say (str &quot;Hello, &quot; name &quot;!&quot;))
</code></pre>
<p>Woah! That's a lot of output.
But it's exactly what I want to tell you about today.</p>
<p>At the bottom is the clojure code we expect.
Above that is the output of each of the seven transformations (aka the 7 states
that come after the first state: our YS input).</p>
<p>Let's look at each of these transformations in turn...</p>
<h3 id="transformation-1-parse">Transformation 1: Parse</h3>
<p>The first transformation is parsing YAML into a sequence of "parse events".
This is by far the hardest transformation, not just for YS but for any YAML
processor.
Sadly, it's so hard that only a few of the dozens of YAML processors out there
actually do it correctly.
See: <a href="https://matrix.yaml.info/">https://matrix.yaml.info/</a></p>
<p>On the other hand, this is actually the simplest part for the YS compiler to
implement.
Why?
Because it uses somebody else's YAML parser!!</p>
<blockquote>
<p>Note: YS currently uses the
<a href="https://bitbucket.org/snakeyaml/snakeyaml-engine">SnakeYAML Engine</a> framework
(only for it's YAML 1.2 parser component).
Later we plan to use <a href="https://github.com/pantoniou/libfyaml">libfyaml</a> which is
currently considered the best YAML parser in the world.
SnakeYAML was the obvious first choice because it's written in Java, YS is
written in Clojure and Clojure is a JVM language.
It's doing a great job for now!</p>
</blockquote>
<p>This is a good time to mention that the YAML data language spec describes
"loading" YAML text into native data structures as a several step process of
states and transformations.
In reality, the YS compiler is really just a very fancy YAML loader!</p>
<p>YAML parsers typically produce 10 different kinds of parse events:</p>
<ul>
<li>Start Stream</li>
<li>End Stream</li>
<li>Start Document</li>
<li>End Document</li>
<li>Start Sequence</li>
<li>End Sequence</li>
<li>Start Mapping</li>
<li>End Mapping</li>
<li>Scalar Value</li>
<li>Alias Reference</li>
</ul>
<p>YS (currently) doesn't care about the first 4 events, so it just ignores them.</p>
<p>That leaves use with a mapping containing 2 key/value pairs:</p>
<pre><code class="language-clojure">[{:+ &quot;+MAP&quot;, :! &quot;yamlscript/v0&quot;}
 {:+ &quot;=VAL&quot;, := &quot;name =&quot;}
 {:+ &quot;=VAL&quot;, :$ &quot;Clojure&quot;}
 {:+ &quot;=VAL&quot;, := &quot;say&quot;}
 {:+ &quot;=VAL&quot;, :$ &quot;Hello, $name!&quot;}
 {:+ &quot;-MAP&quot;}]
</code></pre>
<p>We are showing this state as a Clojure data structure and that's the kind of
serialization that we use in the YS compiler tests.</p>
<p>Here's a quick breakdown of the mapping keywords used above:</p>
<ul>
<li><code>:+</code> is the parse event type</li>
<li><code>:!</code> is the (optional) YAML tag</li>
<li><code>:=</code> is a plain (unquoted) scalar value</li>
<li><code>:$</code> is a double quoted scalar value</li>
</ul>
<p>That was a lot of info, but hopefully it sets the stage for the rest of this
post.</p>
<p>If you are interested in seeing how all this is implemented, check out:</p>
<ul>
<li><a href="https://github.com/yaml/yamlscript/tree/main/core/src/yamlscript">All the YS transformation libraries source code</a></li>
<li>The YS Test Suite Files:</li>
<li><a href="https://github.com/yaml/yamlscript/blob/main/core/test/compiler-stack.yaml">https://github.com/yaml/yamlscript/blob/main/core/test/compiler-stack.yaml</a></li>
<li><a href="https://github.com/yaml/yamlscript/blob/main/core/test/compiler.yaml">https://github.com/yaml/yamlscript/blob/main/core/test/compiler.yaml</a></li>
</ul>
<h3 id="transformation-2-compose">Transformation 2: Compose</h3>
<p>The second transformer is called the composer (in the <code>yamlscript.composer</code>
library).</p>
<pre><code class="language-clojure">{:! &quot;yamlscript/v0&quot;,
 :% [{:= &quot;name =&quot;} {:$ &quot;Clojure&quot;} {:= &quot;say&quot;} {:$ &quot;Hello, $name!&quot;}]}
</code></pre>
<p>Its simple job is to take the parse events and compose them into a tree of
mapping, sequence and scalar nodes.</p>
<p>It preserves the node's tag if any.</p>
<p>Here we see a new keyword <code>:%</code> which is used for a mapping node.
Sequence nodes use the keyword <code>:-</code> but they only show up in data mode, which we
aren't using here.</p>
<p>Now we have all the important information from the YAML input in an AST form
that we can refine (transform) a few more times until it becomes a Clojure AST!</p>
<h3 id="transformation-3-resolve">Transformation 3: Resolve</h3>
<p>YAML tags are rarely seen in the wild.
Many YAML users don't even know they exist.
But tags play an important role in the YAML load process.
Internally every single untagged node is assigned a tag based on heuristics that
consider its kind, position and content.</p>
<p>This process is called "tag resolution" and it's what we are doing here:</p>
<pre><code class="language-clojure">{:ysm
 [{:ysx &quot;def name&quot;}
  {:ysi &quot;Clojure&quot;}
  {:ysx &quot;say&quot;}
  {:ysi &quot;Hello, $name!&quot;}]}
</code></pre>
<p>Notice that all the keywords changed to <code>:ys?</code> here.
This is how YS stores the tag.
Each tag knows what kind of node it is attached to (map, seq or scalar) so, to
keep things simple, it doesn't store that info in the AST.</p>
<blockquote>
<p>Note: Keeping the structure of each state AST as simple as possible is a key
concern of the YS compiler.
It makes it easier to see what's going on when debugging and even more
importantly, it makes it easier to write tests for each transformation.</p>
</blockquote>
<p>The keywords seen above are:</p>
<ul>
<li><code>:ysm</code> is a code mode mapping node</li>
<li><code>:ysi</code> is a scalar that supports interpolation</li>
<li><code>:ysx</code> is a ys expression (a string of code to be further parsed)</li>
</ul>
<p>Tags are are essentially the names of the transformations that will be applied
to the node in the following transformation.</p>
<h3 id="transformation-4-build">Transformation 4: Build</h3>
<p>The build transformation is where a lot of the magic happens.</p>
<p>Most importantly, it's where scalars containing YAMLScript expressions are lexed
and parsed into Clojure expression ASTs.</p>
<pre><code class="language-clojure">{:ysm
 ([{:Sym def} {:Sym name}]
  {:Str &quot;Clojure&quot;}
  {:Sym say}
  {:Lst [{:Sym str} {:Str &quot;Hello, &quot;} {:Sym name} {:Str &quot;!&quot;}]})}
</code></pre>
<p>For instance we can see that the simple string expression "def name" was parsed
into 2 Clojure symbol nodes: <code>{:Sym def}</code> and <code>{:Sym name}</code>.</p>
<p>We can also see that the string expression "Hello, $name!" was parsed into a an
interpolated string expression that joins string literals and variable values
into a single string.</p>
<p>One important aspect of the build output AST is that it retains the original
structure of the YAML input.
Mappings still have key/value pairs, and the key info stays separate from the
value info.</p>
<h3 id="transformation-5-transform">Transformation 5: Transform</h3>
<p>The transformer transformation (that's a bit awkward I'll admit) is where
"special cases" are handled.</p>
<p>Not much happens in this stage yet.
In fact nothing at all happened in this example.</p>
<pre><code class="language-clojure">{:ysm
 [[{:Sym def} {:Sym name}]
  {:Str &quot;Clojure&quot;}
  {:Sym say}
  {:Lst [{:Sym str} {:Str &quot;Hello, &quot;} {:Sym name} {:Str &quot;!&quot;}]}]}
</code></pre>
<p>It's exactly the same as the build output.</p>
<p>In the future, the transform stage is where we will add support for letting
users defined their own syntax and semantic transformations for specific
functions.
If you know about Lisp macros, this will be something spiritually similar.</p>
<p>If you happen to think a particular function should be coded a specific way,
you'll be able to make it so.
As long as you don't break the rules of physics... or YAML!</p>
<p>Note that even though this transformation can change the AST quite a bit, it
still retains its overall YAML structure.</p>
<h3 id="transformation-6-construct">Transformation 6: Construct</h3>
<p>The constructor phase's job is simple.
Turn the final YAML structured AST into an AST that directly represents the
intended Clojure code compilation result.</p>
<p>It does this essentially by applying the function asscoiated with a node's tag
to the node's value.</p>
<pre><code class="language-clojure">{:Lst
 [{:Sym do}
  {:Lst [{:Sym def} {:Sym name} {:Str &quot;Clojure&quot;}]}
  {:Lst
   [{:Sym say}
    {:Lst [{:Sym str} {:Str &quot;Hello, &quot;} {:Sym name} {:Str &quot;!&quot;}]}]}]}
</code></pre>
<p>Every node in this AST directy represents a Clojure code construct.
Voila!</p>
<h3 id="transformation-7-print">Transformation 7: Print</h3>
<p>Just like in any Lisp, a Clojure AST "prints" directly to Clojure code.
This is because every node in the AST is essentially a token that knows how to
print itself!</p>
<p>Again here's our final AST:</p>
<pre><code class="language-clojure">{:Lst
 [{:Sym do}
  {:Lst [{:Sym def} {:Sym name} {:Str &quot;Clojure&quot;}]}
  {:Lst
   [{:Sym say}
    {:Lst [{:Sym str} {:Str &quot;Hello, &quot;} {:Sym name} {:Str &quot;!&quot;}]}]}]}
</code></pre>
<p>The <code>yamlscript.printer/print</code> function converts that to this string (of Clojure
code):</p>
<pre><code class="language-clojure">&quot;(def name \&quot;Clojure\&quot;)\n(say (str \&quot;Hello, \&quot; name \&quot;!\&quot;))\n&quot;
</code></pre>
<p>When that string is printed out, it looks like this:</p>
<pre><code class="language-clojure">(def name &quot;Clojure&quot;)
(say (str &quot;Hello, &quot; name &quot;!&quot;))
</code></pre>
<p>Aaaand, we're done!</p>
<h3 id="transformation-1-7-compile">Transformation 1-7: Compile</h3>
<p>The YAMLScript compiler is just all the above crammed together is sequence;
passing YS input through the 7 transformations we just described.</p>
<p>I'd like to show you the actual YAMLScript <code>compile</code> function (written in
Clojure):</p>
<pre><code class="language-clojure">(defn compile
  &quot;Convert YAMLScript code string to an equivalent Clojure code string.&quot;
  [^String yamlscript-string]
  (-&gt;&gt; yamlscript-string
    yamlscript.parser/parse
    yamlscript.composer/compose
    yamlscript.resolver/resolve
    yamlscript.builder/build
    yamlscript.transformer/transform
    yamlscript.constructor/construct
    yamlscript.printer/print))
</code></pre>
<p>Pretty straightforward, right?
Or if you are more familiar with YAMLScript than Clojure:</p>
<pre><code class="language-yaml">defn compile(yamlscript-string):
  &quot;Convert YAMLScript code string to an equivalent Clojure code string.&quot;:
  -&gt;&gt;:
    yamlscript-string
    yamlscript::parser/parse
    yamlscript::composer/compose
    yamlscript::resolver/resolve
    yamlscript::builder/build
    yamlscript::transformer/transform
    yamlscript::constructor/construct
    yamlscript::printer/print
</code></pre>
<p>I hope I didn't waste too much of your Sunday on this post.
I know it was a lot to take in, and I also know you don't need to know all this
to be a good YAMLScript programmer.</p>
<p>But then again, you probably want to know all about this to become a great one!</p>
<p>See you tomorrow for Day 11 of the YAMLScript Advent Calendar.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../dec-11/" class="md-footer__link md-footer__link--prev" aria-label="Previous: The YeS Express">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                The YeS Express
              </div>
            </div>
          </a>
        
        
          
          <a href="../dec-09/" class="md-footer__link md-footer__link--next" aria-label="Next: Coding with Style">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Coding with Style
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      YAMLScript — Copyright 2022-2025
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.action.edit", "content.action.view", "header.autohide", "navigation.footer", "navigation.indexes", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>