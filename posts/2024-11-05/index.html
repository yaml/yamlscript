<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/posts/2024-11-05/"><link href="/assets/main.089cde16aad3ee63f22f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>The Fall of YAMLScript! | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="The Fall of YAMLScript!"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/posts/2024-11-05/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="The Fall of YAMLScript! by Ingy döt Net | 05 Oct 2024 | 5 min read (or Exciting YAMLScript News for Fall 2024!) Greetings! It&#39;s been over 3..."><meta property="og:description" content="The Fall of YAMLScript! by Ingy döt Net | 05 Oct 2024 | 5 min read (or Exciting YAMLScript News for Fall 2024!) Greetings! It&#39;s been over 3..."><meta name="description" content="The Fall of YAMLScript! by Ingy döt Net | 05 Oct 2024 | 5 min read (or Exciting YAMLScript News for Fall 2024!) Greetings! It&#39;s been over 3..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript-logo.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/doc">Docs</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>The Fall of YAMLScript!</h1><div class="post__details">by <a href="/about/#ingydotnet">Ingy döt Net</a> <span>| </span><time datetime="2024-10-05">05 Oct 2024 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><h2>(or Exciting YAMLScript News for Fall 2024!)</h2><p>Greetings!</p><p>It's been over 3 months since the last blog post here.</p><p>Just to be clear, the YAMLScript project is alive and fantastic!</p><p>We've just been busy as hell on 2 very big things: <a href="https://exercism.org"><strong>Exercism</strong></a> and <a href="https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/"><strong>KubeCon</strong></a>.</p><p>To be successful in both of these endeavors, YAMLScript needed to be amazing both as a programming language (Exercism) and as a data language (KubeCon).</p><p>There's so much new stuff to talk about, and I promise to write about it all of them after things get back to a normal pace.</p><p>Today let's talk about Exercism, KubeCon and the positive impacts they've had on YAMLScript.</p><h2>Exercism</h2><p>When I learned about the &quot;free programming language learning website&quot; called <a href="https://exercism.org">Exercism</a> in June, it supported 71 <a href="https://exercism.org/tracks">language tracks</a>. I hoped that YAMLScript could become number 72.</p><p>I was in Las Vegas at <a href="https://tprc.us/tprc-2024-las/">The Perl and Raku Conference</a> where I met Daniel Mita who is a maintainer of the Perl and Raku tracks on Exercism. Over breakfast, he told me all about the Exercism platform and and it sounded great. I asked him if it would be possible to add a YAMLScript track to Exercism.</p><p>Some hours later he had started the process to make that happen...</p><p>Fast forward to mid September; the <a href="https://www.linkedin.com/posts/ihidjeremywalker_yamlscript-on-exercism-activity-7249329338561499136-YKyM/"><strong>YAMLScript track is live as number 74</strong></a>!</p><p>The <a href="https://exercism.org/tracks/yamlscript">YAMLScript track</a> currently offers 60 exercises of varying difficulty levels. Try it out and let us know what you think!</p><h3>How Exercism Made YAMLScript Better</h3><p>To get the YAMLScript track launched it was required that at least 20 exercises be set up. We launched with 42, of course!</p><p>To set up an exercise for a track, you need to write a program that passes a series of tests that are provided for the exercise. Personally I wanted these YAMLScript solutions to be as simple and beautiful as possible.</p><p>The main way YAMLScript has grown as a language is from actually writing code with it and seeing what works beautifully and what doesn't. If something can be done to make the language better, we do it.</p><p>I can confidently say that YAMLScript produces some of the most beautiful solutions to the Exercism exercises. In fact I wrote <a href="https://github.com/ingydotnet/yamlscript-vs-exercism/">a program</a> (in YAMLScript) that compares the YAMLScript solutions to all the other languages on Exercism as a markdown page and then posts it as a GitHub gist page.</p><p>I won't share these gists here, because that would be a spoiler for the Exercism platform. But since all these solutions are publicly available and open source, you can run that program yourself and see the results.</p><p>However I did think of a way to do something similar that I can share here...</p><p>I wrote a another (nearly identical) <a href="https://github.com/ingydotnet/yamlscript-vs-rosetta/blob/main/bin/ys-vs-rc">program</a> that compares YAMLScript solutions to other languages for the massive open source code site <a href="https://rosettacode.org">Rosetta Code</a>.</p><p>Here's a few example gists that compare Rosetta Code YAMLScript solutions to those in the Exercism set of languages:</p><ul><li><a href="https://gist.github.com/ingydotnet/93753b50508670b22a309322b7236046">99-bottles-of-beer</a></li><li><a href="https://gist.github.com/ingydotnet/b995728875279d7b508b076525ef5d69">FizzBuzz</a></li><li><a href="https://gist.github.com/ingydotnet/337517fb9c599c5a8e01c0a5355b6370">Floyds-triangle</a></li><li><a href="https://gist.github.com/ingydotnet/c39752822b2197191e320e46ddde025c">Rot-13</a></li></ul><p>As you can see, YAMLScript programs turn out to to be very clean, simple and easy to read.</p><p>If you are going to enhance your YAML files with functional logic, it's reassuring to know that YAMLScript has the full power of a mature programming language behind it (Clojure), presented in a way that is not only as easy to read as YAML, but is actually 100% valid YAML.</p><p>Let's segue to KubeCon, where we focus on YAMLScript as a way to tame large YAML configuration files for Kubernetes and other software frameworks.</p><h2>KubeCon</h2><p>In early June I proposed a 90 minute YAMLScript tutorial for KubeCon and it was accepted! I'll be presenting it a week from this Friday (<a href="">November 15th in Salt Lake City</a>). If you are going to be at the conference, I hope we get a chance to talk.</p><p>The YAMLScript needs for <a href="https://kubernetes.io/">Kubernetes</a> (and other) config files are very different than its needs for Exercism. Kubernetes is configured with YAML, as are many other software frameworks used by <a href="https://www.cncf.io/">Cloud Native</a> programmers.</p><p>While YAMLScript is a great as a programming language, one of its main goals has always been to fix as many of the problems people have with YAML as possible.</p><p>Of course, we are aware that there are already lots of tools that help with managing large YAML files for various applications. YAMLScript is not trying to replace those tools, but to augment them.</p><p>For instance, many people use <a href="https://helm.sh/">Helm</a> to manage their Kubernetes. Helm is a complete package manager for Kubernetes, that comes with a Go based templating system.</p><p>YAMLScript can be used instead of (or in combination with) Helm's templating system.</p><p>Let's look at an example of using YAMLScript in a Helm chart template.</p><p>Here's a snippet of a template file created by <code>helm create mychart</code>:</p><pre class="language-yaml"><code class="language-yaml">  <br>  <span class="token key atrule">spec</span><span class="token punctuation">:</span><br>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span><br>      <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> toYaml . <span class="token punctuation">|</span> nindent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span><br>    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span><br>    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.nodeSelector <span class="token punctuation">}</span><span class="token punctuation">}</span><br>    <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span><br>      <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> toYaml . <span class="token punctuation">|</span> nindent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span><br>    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span><br>    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.affinity <span class="token punctuation">}</span><span class="token punctuation">}</span><br>  </code></pre><p>With YAMLScript, you can write this as:</p><pre class="language-yaml"><code class="language-yaml">  <span class="token key atrule">spec</span><span class="token punctuation">:</span><br>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span><br>      <span class="token punctuation">:</span>when+ Values.volumes.<span class="token punctuation">?</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>volumes<span class="token punctuation">:</span><span class="token punctuation">:</span> _<span class="token punctuation">}</span><br>      <span class="token punctuation">:</span>when+ Values.nodeSelector.<span class="token punctuation">?</span><span class="token punctuation">:</span><span class="token punctuation">:</span><br>       nodeSelector<span class="token punctuation">:</span><span class="token punctuation">:</span> _</code></pre><p>Not only is the YAMLScript version much shorter and easier to read, its also valid YAML. That means it can be maintained using other YAML tools, like <code>yamllint</code>. It also gets rid of the need for the <code>nindent</code> explicit indenting function, which is a common source of errors in Helm templates.</p><p>If you want to see an entire Helm chart written converted to YAMLScript, we made <a href="https://github.com/ingydotnet/ys-test-chart">a repository</a> with 2 commits: one with the original Helm chart and one after the conversion.</p><p>Or you can simply look at <a href="https://gist.github.com/ingydotnet/6537f43709e4a08bace4604074e83965">this gist</a> which shows the changed files side by side. This gist was also generated by a new YAMLScript program called <a href="https://github.com/ingydotnet/sbs/blob/main/bin/sbs">sbs</a> (side by side).</p><h3>How KubeCon Made YAMLScript Better</h3><p>Just because YAMLScript is a great programming language, and embeddable in YAML, doesn't mean that it will be a natural fit for every common config file need.</p><p>As we reviewed the needs for using YAMLScript in Helm charts, we found a couple things that could be improved.</p><p>The first was being able to load external data and define variables in a file that is just data.</p><p>As you might recall, to use YAMLScript in a YAML file, you need to use the special <code>!yamlscript/v0/</code> tag at the top. Note the difference between that tag and the <code>!yamlscript/v0</code> tag that we need to start a YAMLScript <em>program</em>.</p><p>The trailing slash means to start off in &quot;data mode&quot; instead of &quot;code mode&quot;. This means the the unquoted word <code>foo</code> is a string, not a variable or function.</p><p>But say you want to load another file and use its contents as data (without having any effect on the YAML data you are defining in the current file).</p><p>Now you can do that (at any lexical level) with a normal YAMLScript assignment.</p><pre class="language-yaml"><code class="language-yaml"><span class="token tag">!yamlscript/v0/</span><br><br><span class="token key atrule">default =</span><span class="token punctuation">:</span> load('defaults.yaml')<br><br>foo<span class="token punctuation">:</span><span class="token punctuation">:</span> default.foo.take(3)<br><span class="token key atrule">bar</span><span class="token punctuation">:</span><br>  <span class="token key atrule">more =</span><span class="token punctuation">:</span> load('more.yaml')<br>  baz<span class="token punctuation">:</span><span class="token punctuation">:</span> more.stuff * default<span class="token punctuation">:</span>count</code></pre><p>The <code>=:</code> pairs are code expressions that define new variables. The first one above applies to the entire file and the second one applies only to the map that contains it.</p><p>Another thing we found was that we needed a way to conditionally include key/value pairs in a YAML map.</p><p>We added a general <code>::</code> form that evaluates any code. If the evaluation result is a map, it is merged into the current map at the current position. If it evaluates to <code>nil</code>, nothing is added.</p><pre class="language-yaml"><code class="language-yaml"><span class="token tag">!yamlscript/v0/</span><br><br><span class="token key atrule">foo</span><span class="token punctuation">:</span> <span class="token number">1</span><br><span class="token punctuation">:</span><span class="token punctuation">:</span><br>  when rand(2) <span class="token punctuation">></span> 1<span class="token punctuation">:</span><span class="token punctuation">:</span><br>    <span class="token key atrule">bar</span><span class="token punctuation">:</span> <span class="token number">2</span><br><span class="token key atrule">baz</span><span class="token punctuation">:</span> <span class="token number">3</span></code></pre><p>This is a very powerful way to conditionally add data using any logic you want.</p><p>However its a bit verbose for simple cases. Consider this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token tag">!yamlscript/v0/</span><br><br><span class="token key atrule">data =</span><span class="token punctuation">:</span> load('data.yaml')<br><br><span class="token key atrule">foo</span><span class="token punctuation">:</span> <span class="token number">1</span><br><span class="token punctuation">:</span><span class="token punctuation">:</span><br>  when data.key1<span class="token punctuation">:</span><span class="token punctuation">:</span><br>    <span class="token key atrule">bar</span><span class="token punctuation">:</span> data.key1<br><span class="token key atrule">baz</span><span class="token punctuation">:</span> <span class="token number">3</span></code></pre><p>We added a shorthand for this common case:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">:</span>when data.key1<span class="token punctuation">:</span><span class="token punctuation">:</span><br> <span class="token key atrule">bar</span><span class="token punctuation">:</span> data.key1</code></pre><p>You can collapse the <code>::</code> and the <code>when</code> function line into a single line.</p><p>But notice the glaring redundancy of needing to write <code>data.key1</code> twice?</p><p>We addressed that with the new <code>when+</code> function.</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">:</span>when+ data.key1<span class="token punctuation">:</span><span class="token punctuation">:</span><br> <span class="token key atrule">bar</span><span class="token punctuation">:</span> _</code></pre><p>It sets the <code>_</code> variable to the value of its condition expression <code>data.key1</code>.</p><p>Finally we can collapse that to a single line by simply using YAML's flow style:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">:</span>when+ data.key1.<span class="token punctuation">?</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">bar</span><span class="token punctuation">:</span> _<span class="token punctuation">}</span></code></pre><h2>Conclusion</h2><p>The YAMLScript project is alive and well. It's both a great programming language and a great data language. While it is already extremely capable, we are always looking for ways to make it better.</p><p>I'm very excited to present all this next week at KubeCon. And again, I hope to see you there!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/blog/">#blog</a></div><nav class="post__pagination"><a href="/posts/2024-07-17/"><span>←</span> <span>Go Julia!</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>