<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/posts/2024-04-16/"><link href="/assets/main.fc9b07030678f58b9d0b.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>YAMLScript Spring Update | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="YAMLScript Spring Update"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/posts/2024-04-16/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="YAMLScript Spring Update by Ingy döt Net | 16 Apr 2024 | 6 min read It&#39;s been a while since I let you know what&#39;s been happening with..."><meta property="og:description" content="YAMLScript Spring Update by Ingy döt Net | 16 Apr 2024 | 6 min read It&#39;s been a while since I let you know what&#39;s been happening with..."><meta name="description" content="YAMLScript Spring Update by Ingy döt Net | 16 Apr 2024 | 6 min read It&#39;s been a while since I let you know what&#39;s been happening with..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript-logo.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/doc">Docs</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>YAMLScript Spring Update</h1><div class="post__details">by <a href="/about/#ingydotnet">Ingy döt Net</a> <span>| </span><time datetime="2024-04-16">16 Apr 2024 </time><span>| </span><span>6 min read</span></div></header><main class="post__content"><p>It's been a while since I let you know what's been happening with YAMLScript. I've been busy working on it every day this year and I have a lot to tell you about!</p><h3>YAMLScript Activity in 2024</h3><p>Let me start by telling you about some of the events that have happened in the YAMLScript world recently.</p><ul><li><a href="https://www.youtube.com/watch?v=GajOBwBcFyA">Seajure Talk</a> - I gave a talk at the Seajure (Seattle Clojure) Meetup in March.</li><li><a href="https://thenewstack.io/with-yamlscript-yaml-becomes-a-proper-programming-language/">YAMLScript Article</a> - The New Stack published an article about YAMLScript in March</li><li><a href="https://www.therepl.net/episodes/52/">YAMLScript Podcast</a> - I was interviewed on the &quot;The REPL&quot; by Daniel Compton in April.</li></ul><p>Finally I'm presenting a talk about <a href="https://sched.co/1aBPY">YAMLScript at the Open Source Summit North America</a> this Thursday, April 18th. Super excited about that!</p><h3>YAMLScript Progress Since the Advent Series</h3><p>I blogged about YAMLScript every day in December 2023. That was something. We were madly trying to implement all the stuff I was talking about. I may have told a few small lies along the way, but I'm happy to say that everything I talked about is now implemented and working.</p><p>And of course we've added a lot more since then.</p><p>Let's talk about some of the highlights.</p><h3>More YAMLScript Language Binding Libraries</h3><p>We've added 4 new binding libraries for YAMLScript in 2024, bringing the total to 8: <a href="https://clojars.org/org.yamlscript/clj-yamlscript">Clojure</a> (new), <a href="https://clojars.org/org.yamlscript/yamlscript">Java</a> (new), <a href="https://www.npmjs.com/package/@yaml/yamlscript">NodeJS</a> (new), <a href="https://metacpan.org/dist/YAMLScript/view/lib/YAMLScript.pod">Perl</a>, <a href="https://pypi.org/project/yamlscript/">Python</a>, <a href="https://raku.land/zef:ingy/YAMLScript">Raku</a>, <a href="https://rubygems.org/search?query=yamlscript">Ruby</a> (new) and <a href="https://crates.io/crates/yamlscript">Rust</a>.</p><p>The idea is to eventually have binding libraries for every language where YAML is currently used. I expect more to come soon. If you see a missing language that you want (and you are handy with FFI), please consider writing a binding library for it and submitting a PR to the <a href="https://github.com/yaml/yamlscript">YAMLScript Mono Repository</a>.</p><p>All the libraries are a small amount of code and are easy to write.</p><p>If you need help, please stop by the <a href="https://matrix.to/#/#chat-yamlscript:yaml.io">YAMLScript Matrix Chat Room</a> and we'll get you what you need.</p><h3>New Dot Chaining Operator</h3><p>In Clojure you can write:</p><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">take</span> <span class="token number">5</span><br>  <span class="token punctuation">(</span><span class="token function">shuffle</span><br>    <span class="token punctuation">(</span><span class="token keyword">filter</span> even?<br>      <span class="token punctuation">(</span><span class="token keyword">range</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><blockquote><p>Evaluates to something like: <code>[94 36 4 70 74]</code></p></blockquote><p>Often people like to use Clojure's threading macro (<code>-&gt;</code>) to make this more readable:</p><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">->></span> <span class="token punctuation">(</span><span class="token keyword">range</span> <span class="token number">100</span><span class="token punctuation">)</span><br>     <span class="token punctuation">(</span><span class="token keyword">filter</span> even?<span class="token punctuation">)</span><br>     <span class="token punctuation">(</span><span class="token function">shuffle</span><span class="token punctuation">)</span><br>     <span class="token punctuation">(</span><span class="token keyword">take</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Let's look at the same thing in YAMLScript in various styles.</p><p>Basic block style:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">take 5</span><span class="token punctuation">:</span><br>  <span class="token key atrule">shuffle</span><span class="token punctuation">:</span><br>    <span class="token key atrule">filter even?</span><span class="token punctuation">:</span><br>      <span class="token key atrule">range</span><span class="token punctuation">:</span> <span class="token number">100</span></code></pre><p><a href="https://yamlscript.org/doc/yes/">Yes Expression style</a>:</p><pre class="language-yaml"><code class="language-yaml">take(5<br>  shuffle(<br>    filter(even<span class="token punctuation">?</span><br>      range(100))))</code></pre><p>Clojure threading style:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">->> range(100)</span><span class="token punctuation">:</span><br>  filter(even<span class="token punctuation">?</span>)<br>  shuffle<br>  take(5)</code></pre><p>And now with the new dot chaining operator:</p><pre class="language-yaml"><code class="language-yaml">range(100)<br>  .filter(even<span class="token punctuation">?</span>)<br>  .shuffle()<br>  .take(5)</code></pre><p>Or all on one line:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">$ ys -e 'say</span><span class="token punctuation">:</span> range(100).filter(even<span class="token punctuation">?</span>).shuffle().take(5)'</code></pre><h4>More about the Dot Chaining Operator</h4><p>Above we used the dot operator to chain function calls together. But it's even more useful than that.</p><p>Consider:</p><pre class="language-yaml"><code class="language-yaml">a.b.3.c().d(e).f(g _).$h</code></pre><p>If <code>a</code> is a mapping, the <code>&quot;b&quot;</code> (or <code>:b</code> or <code>'b</code>) key is looked up.<br><code>3</code> is the 4th element of the list that <code>b</code> resolves to.<br><code>c</code> is called as a function with the result of <code>3</code> as an argument.<br><code>d</code> is called as a function with the result of <code>c</code> and <code>e</code> as arguments.<br><code>f</code> is called as a function with <code>g</code> and the result of <code>d</code> as arguments.<br>Finally the key in variable <code>h</code> is looked up in the result of <code>f</code>.</p><p>One common idiom is looking up environment variables. For example: <code>ENV.HOME</code> or <code>ENV.USER.str/upper-case()</code>.</p><h3>New Operators and Syntax</h3><p>In the last section we saw the new chaining operator: <code>.</code>.</p><p>The interesting thing to note here is that <code>.</code> already had a meaning in Clojure. It's the namespace separator, as in <code>clojure.core/println</code>.</p><p>YAMLScript uses <code>::</code> for that separator instead, so we'd say <code>clojure::core/println</code>.</p><p>In a similar switch-up, we added the <code>%</code> and <code>%%</code> operators. <code>(a % b)</code> compiles to the Clojure code <code>(rem a b)</code>, and <code>(a %% b)</code> compiles to <code>(mod a b)</code>; 2 slightly different math functions.</p><p>In Clojure, <code>%</code> was already a shorthand for the <code>%1</code> argument in anonymous functions.</p><p>In YAMLScript, you'll need to use <code>%1</code> for that:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">square =</span><span class="token punctuation">:</span> \(%1 * %1)</code></pre><p>Next we added <code>**</code> for exponentiation. So <code>2 ** 3</code> compiles to <code>(pow 2 3)</code>. We also added <code>pow</code> to the <code>ys::std</code> YAMLScript standard library, so you can say <code>pow(2 3)</code> instead of <code>math/pow(2 3)</code>. More about the standard library in a bit.</p><p>We added the Perl style regex operators <code>=~</code>, <code>!~</code> and regex literal <code>/.../</code>.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">if peanut-butter =~ /chocolate/</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">"You've got chocolate in my peanut butter!"</span></code></pre><p>You might have noticed that YAMLScript uses <code>\( ... )</code> for anonymous functions, where Clojure uses <code>#( ... )</code>. Things starting with <code>#</code> are comments in YAML, so that's problematic.</p><p>We decided the <code>\</code> would be a general purpose escape character, but Clojure already uses <code>\</code> for escaping character literals.</p><p>YAMLScript now uses <code>\\</code> for that purpose: <code>str(\\a \\b \\c)</code> would evaluate to <code>&quot;abc&quot;</code>.</p><p>In Clojure you see <code>'foo</code> used extensively for quoting symbols. In YAML, single quotes are used for string literals, and I felt it was important to keep that distinction.</p><p>Luckily in Clojure you can use <code>(quote foo)</code> for the same thing. In YAMLScript you can use <code>quote(foo)</code>. We added the shorthand <code>q(foo)</code> as well as <code>\'foo</code> for quoting.</p><p>Finally, we added <code>foo*</code> splatting.</p><p>It is common in Clojure to use <code>apply</code> to call a function with a list of arguments: <code>(apply f [1 2 3])</code> is the same as <code>(f 1 2 3)</code>. So if <code>xs</code> is a sequence of numbers, you'd say <code>(apply f xs)</code>.</p><p>In YAMLScript you can say <code>f(xs*)</code> instead.</p><p>But it gets better. You can you use <code>xs*</code> anywhere in a list of arguments: <code>f(1 xs* 3 ys* 5)</code>.</p><h3>Standard Global Variables</h3><p>Clojure has dynamic variables like <code>*out*</code> and <code>*command-line-args*</code>.</p><p>YAMLScript now has a few of these, but we decided to use symbols with <code>ALL-CAPS</code> instead of <code>*earmuffs*</code> for these. We also made them shorter in some cases.</p><ul><li><code>ARGV</code> - Command line arguments</li><li><code>ARGS</code> - Like <code>ARGV</code> but numbers are converted to numeric values</li><li><code>ENV</code> - Environment variable mapping</li><li><code>CWD</code> - Current working directory</li><li><code>FILE</code> - Path to the current file being processed</li><li><code>INC</code> - The YAMLScript module include path</li><li><code>VERSIONS</code> - Mapping of versions of key components in YAMLScript</li></ul><p>We'll be adding more of these as needed.</p><h3>The <code>ys::std</code> YAMLScript Standard Library</h3><p>We added many libraries that are automatically available in every YAMLScript program:</p><ul><li><code>ys::std</code> - The standard library (also available <code>std</code>)</li><li><code>clojure::str</code> - available as <code>str</code></li><li><code>clojure::math</code> - available as <code>math</code></li><li><code>clojure::tools::cli</code> - available as <code>cli</code></li><li><code>babashka::fs</code> - avaiable as <code>fs</code></li><li><code>babashka::http</code> - available as <code>http</code></li></ul><p>and more.</p><p>The <code>ys::std</code> library is the most important one. We can see all the functions available in it by running:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-e</span> <span class="token string">'say: q(std).ns-publics().keys().sort().vec()'</span> <span class="token operator">|</span> zprint <span class="token string">'{:width 40}'</span><br><span class="token punctuation">[</span><span class="token variable">$$</span> *_ +++ +++* +_ <span class="token operator">=</span>-- _<span class="token operator">&amp;</span> _* _** _T __<br> _dot abspath <span class="token function">curl</span> cwd die <span class="token function">dirname</span> each<br> err <span class="token builtin class-name">exec</span> <span class="token function">join</span> new num omap out pow pp<br> pretty print process q rng say <span class="token function">sh</span> shell<br> <span class="token function">sleep</span> throw toBool toFloat toInt toMap<br> toStr use-pod warn www xxx yyy zzz<span class="token punctuation">]</span></code></pre><p>You might note that the <code>print</code> function is part of <code>clojure::core</code> and YAMLScript offers all of that by default. In a few places we decided to replace Clojure functions with our own versions. But we also added a <code>ys::clj</code> library that has all the original versions of the replaced Clojure functions in it.</p><p>So if you really need <code>clojure::core/print</code>, you can say <code>clj/print</code>.</p><p>Here are the functions in <code>ys::clj</code>:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-e</span> <span class="token string">'say: q(clj).ns-publics().keys().sort().vec()'</span> <span class="token operator">|</span> zprint <span class="token string">'{:width 40}'</span><br><span class="token punctuation">[</span>compile load load-file num print use<span class="token punctuation">]</span></code></pre><p>Not too many.</p><p>We'll look at <code>use</code> in the next section.</p><h3>Including YAMLScript Libraries and Modules</h3><p>I'll start by saying we made the <code>require</code> function nice to use in YAMLScript.</p><p>The best way to describe it is to show you the actual test case for it:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Various require transformations in one pair<br>  <span class="token key atrule">yamlscript</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>    !yamlscript/v0<br>    require:<br>      foo::aaa: => fa<br>      foo::bbb: one<br>      foo::ccc: one two<br>      foo::ddd:<br>        => fd<br>        one two<br>      foo::eee:<br>      foo::fff: :all</span><br>  <span class="token key atrule">clojure</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>    (require<br>      '[foo.aaa :as fa]<br>      '[foo.bbb :refer [one]]<br>      '[foo.ccc :refer [one two]]<br>      '[foo.ddd :as fd :refer [one two]]<br>      'foo.eee<br>      '[foo.fff :refer :all])</span></code></pre><p>That's how we write tests for the YAMLScript compiler.</p><p>I think it explains how <code>require</code> works in YAMLScript pretty well.</p><p>The <code>require</code> function is used for including Clojure libraries. We've also added support for writing libraries in YAMLScript itself. We'll call them &quot;modules&quot; to distinguish them from Clojure libraries.</p><p>To use a module in YAMLScript, you use the <code>use</code> function.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">use</span><span class="token punctuation">:</span> <span class="token string">'my-module'</span></code></pre><p>This will look for a file called <code>my-module.ys</code> in the <code>INC</code> path.</p><p>The <code>INC</code> path is a list of directories that YAMLScript will look in for and it defaults to the current directory. You can override the <code>INC</code> path by setting the <code>YSPATH</code> environment variable.</p><p>YAMLScript also added support for <a href="https://book.babashka.org/#pods">Babashka Pods</a>. You can use a pod in YAMLScript like this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">use-pod</span><span class="token punctuation">:</span> "org.babashka/go<span class="token punctuation">-</span>sqlite3" "0.1.0"</code></pre><h3>Multi-doc and Anchor / Alias Support</h3><p>This is the last topic for today, but it's a big one.</p><p>Anchors and aliases are an important feature of YAML. They let you mark a node with a name and then refer to that node by name later.</p><p>Until now, YAMLScript has not supported anchors and aliases. Supporting them is critical because YAMLScript should be able to load all existing YAML config files, and config files often use anchors and aliases.</p><p>Well not only did we add support, we took them to the next level!</p><p>YAML has the concept of multiple documents in a single file. Unfortunately, this is not very useful in the real world; at least not for config files. One problem is that YAML doesn't allow you to make an anchor in one document and use an alias to it in another document.</p><p>YAMLScript makes great use of multi-doc combined with anchors and aliases.</p><p>Here's an example YAMLScript file <code>file.ys</code> that is part of my <a href="https://sched.co/1aBPY">upcoming talk at Open Source Summit North America on Thursday</a>:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span> <span class="token tag">!yamlscript/v0/</span><br><br><span class="token punctuation">-</span> <span class="token important">&amp;data</span> <span class="token tag">!</span><br>  <span class="token key atrule">yaml/load</span><span class="token punctuation">:</span> slurp('data.yaml')<br><br><span class="token punctuation">-</span> <span class="token important">&amp;map1</span><br>  <span class="token key atrule">key</span><span class="token punctuation">:</span> value<br><br><span class="token punctuation">-</span> <span class="token important">&amp;seq1</span><br>  <span class="token punctuation">-</span> one<br>  <span class="token punctuation">-</span> two<br><br><span class="token punctuation">-</span> <span class="token important">&amp;dogs</span> <span class="token tag">!</span><br>  <span class="token key atrule">yaml/load</span><span class="token punctuation">:</span><br>    curl<span class="token punctuation">:</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//yamlscript.org/dogs.yaml<br><br><span class="token punctuation">---</span> <span class="token tag">!yamlscript/v0/</span><br><br><span class="token key atrule">some</span><span class="token punctuation">:</span> plain data string<br><span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">42</span><br><br>sentence<span class="token punctuation">:</span><span class="token punctuation">:</span><br>  "$(<span class="token important">*data.name)</span> likes<br>  $(<span class="token important">*data.langs.rand-nth())</span><span class="token tag">!</span><span class="token tag">!</span><span class="token tag">!</span>"<br>2 dogs<span class="token punctuation">:</span><span class="token punctuation">:</span> .<span class="token important">*dogs.big.shuffle().take(2)</span><br><br><span class="token key atrule">sequence</span><span class="token punctuation">:</span> <span class="token tag">!concat*:</span><br><span class="token punctuation">-</span> <span class="token important">*seq1</span><br><span class="token punctuation">-</span> <span class="token punctuation">[</span>three<span class="token punctuation">,</span> four<span class="token punctuation">]</span><br><span class="token key atrule">mapping</span><span class="token punctuation">:</span> <span class="token tag">!merge*:</span><br><span class="token punctuation">-</span> <span class="token key atrule">this</span><span class="token punctuation">:</span> that<br><span class="token punctuation">-</span> <span class="token important">*map1</span></code></pre><p>The <code>data.yaml</code> file that gets loaded looks like this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Ingy<br><span class="token key atrule">langs</span><span class="token punctuation">:</span><br><span class="token punctuation">-</span> Bash<br><span class="token punctuation">-</span> Clojure<br><span class="token punctuation">-</span> CoffeeScript<br><span class="token punctuation">-</span> Perl<br><span class="token punctuation">-</span> YAMLScript</code></pre><p>When you run <code>ys -Y file.ys</code> you get:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">some</span><span class="token punctuation">:</span> plain data string<br><span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">42</span><br><span class="token key atrule">sentence</span><span class="token punctuation">:</span> Ingy likes CoffeeScript<span class="token tag">!</span><span class="token tag">!</span><span class="token tag">!</span><br><span class="token key atrule">2 dogs</span><span class="token punctuation">:</span><br><span class="token punctuation">-</span> Saint Bernard<br><span class="token punctuation">-</span> Great Dane<br><span class="token key atrule">sequence</span><span class="token punctuation">:</span><br><span class="token punctuation">-</span> one<br><span class="token punctuation">-</span> two<br><span class="token punctuation">-</span> three<br><span class="token punctuation">-</span> four<br><span class="token key atrule">mapping</span><span class="token punctuation">:</span><br>  <span class="token key atrule">this</span><span class="token punctuation">:</span> that<br>  <span class="token key atrule">key</span><span class="token punctuation">:</span> value</code></pre><blockquote><p>Note: I really do like CoffeeScript! A lot!!</p></blockquote><p>I'll let you figure out what's happening here. It should be fairly obvious and I think it's all pretty cool.</p><h3>Moving Forward</h3><p>That was a lot of information, I know. I haven't really found the time to blog about these changes on a regular basis.</p><p>Hopefully I'll be able to do that more in the future.</p><p>Cheers!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/blog/">#blog</a></div><nav class="post__pagination"><a href="/posts/2024-03-14/"><span>←</span> <span>YAMLScript Firsts</span> </a><a href="/posts/2024-06-20/"><span>Dr. StrangeYAML or How I Learned to Stop Worrying and Love the LLM</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>