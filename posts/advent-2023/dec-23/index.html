<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/posts/advent-2023/dec-23/"><link href="/assets/main.7eeaf7bb0c5b5da98e70.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Perl to Rust | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Perl to Rust"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/posts/advent-2023/dec-23/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="Perl to Rust by Ingy döt Net | 23 Dec 2023 | 5 min read When Santa is doing his job in the Luxembourg area, I&#39;ve always wondered how he gets..."><meta property="og:description" content="Perl to Rust by Ingy döt Net | 23 Dec 2023 | 5 min read When Santa is doing his job in the Luxembourg area, I&#39;ve always wondered how he gets..."><meta name="description" content="Perl to Rust by Ingy döt Net | 23 Dec 2023 | 5 min read When Santa is doing his job in the Luxembourg area, I&#39;ve always wondered how he gets..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Perl to Rust</h1><div class="post__details">by <a href="/about/#ingydotnet">Ingy döt Net</a> <span>| </span><time datetime="2023-12-23">23 Dec 2023 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><p>When Santa is doing his job in the Luxembourg area, I've always wondered how he gets from Perl to Rust.</p><p>Maybe he takes <a href="https://oylenshpeegul.gitlab.io/from-perl-to-rust/introduction.html">this route</a>!</p><h3>Welcome to Day 23 of the YAMLScript Advent Blog!</h3><p>A couple of days ago we showed you how to use YAMLScript from Python.</p><p>One language binding down, forty-one to go!</p><p>Today we'll show you how to use YAMLScript with 3 new programming language bindings: <strong>Perl</strong>, <strong>Rust</strong> and <strong>Raku</strong> (aka Perl 6).</p><p>YAMLScript gets by with a little help from its friends:</p><ul><li><a href="https://github.com/tony-o">@tony-o</a> - Raku binding</li><li><a href="https://github.com/ethiraric">@ethiraric</a> - Rust binding</li><li><a href="https://github.com/jjatria">@jjatria</a> - Perl binding</li><li><a href="https://github.com/vendethiel">@vendethiel</a> - Polyglot extraordinaire</li></ul><p>These guys are awesome!</p><h3>I Heard a Rumor!</h3><p>Let's make up a little YAMLScript program that we can run from all the new YAMLScript bindings:</p><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># hearsay.ys</span><br><br><span class="token comment"># ys --load hearsay.ys | jq -r .</span><br><br><span class="token tag">!yamlscript/v0</span><br><br>hackers =<span class="token punctuation">:</span><span class="token punctuation">:</span><br><span class="token punctuation">-</span> ethiraric<br><span class="token punctuation">-</span> ingydotnet<br><span class="token punctuation">-</span> jjatria<br><span class="token punctuation">-</span> tony<span class="token punctuation">-</span>o<br><br>languages =<span class="token punctuation">:</span><span class="token punctuation">:</span><br><span class="token punctuation">-</span> Perl<br><span class="token punctuation">-</span> Python<br><span class="token punctuation">-</span> Raku<br><span class="token punctuation">-</span> Rust<br><br><span class="token key atrule">=></span><span class="token punctuation">:</span> "I heard that @$rand<span class="token punctuation">-</span>nth(hackers) uses YAMLScript<br>    in their $rand<span class="token punctuation">-</span>nth(languages) code<span class="token tag">!</span>"<br></code></pre><p>Now run (actually &quot;load&quot;) this a few times using the YAMLScript <code>ys --load</code> command:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">--load</span> hearsay.ys <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token builtin class-name">.</span><br>I heard that @tony-o uses YAMLScript <span class="token keyword">in</span> their Rust code<span class="token operator">!</span><br>$ ys <span class="token parameter variable">--load</span> hearsay.ys <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token builtin class-name">.</span><br>I heard that @ethiraric uses YAMLScript <span class="token keyword">in</span> their Python code<span class="token operator">!</span><br>$ ys <span class="token parameter variable">--load</span> hearsay.ys <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token builtin class-name">.</span><br>I heard that @jjatria uses YAMLScript <span class="token keyword">in</span> their Rust code<span class="token operator">!</span><br>$ ys <span class="token parameter variable">--load</span> hearsay.ys <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token builtin class-name">.</span><br>I heard that @ingydotnet uses YAMLScript <span class="token keyword">in</span> their Perl code<span class="token operator">!</span><br>$ ys <span class="token parameter variable">--load</span> hearsay.ys <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token builtin class-name">.</span><br>I heard that @vendethiel uses YAMLScript <span class="token keyword">in</span> their Raku code<span class="token operator">!</span><br>$</code></pre><p>Works like a charm!</p><p><strong>Now let's load this program from each of the new language bindings!</strong></p><h3>Perl</h3><p>I've been programming Perl for a very long time. 25 years actually. I've published over 200 Perl modules on CPAN. My first one was called <a href="https://metacpan.org/pod/Inline::C">Inline::C</a> which makes it trivial to write C bindings in Perl.</p><p>That's exactly what I needed to get done today to write this blog post about it. Ironically, I've forgotten how to use Inline::C, so I asked an AI to do it for me. It gave me something reasonable looking, but I couldn't get it working.</p><p>But the best part of Perl is its community! My good Perl friend <a href="https://metacpan.org/author/OALDERS">Olaf</a> told me to seek out a Perl programmer named <a href="https://metacpan.org/author/JJATRIA">JJ</a>. I did and he was happy to help. He got it done in no time, and now I'm writing about it!!!</p><p>JJ used the newer Perl FFI binding framework called <a href="https://metacpan.org/pod/FFI::Platypus">FFI::Platypus</a>.</p><p>Let's use the new CPAN module YAMLScript to run our <code>hearsay.ys</code> program:</p><pre class="language-perl"><code class="language-perl"><span class="token comment"># hearsay.pl</span><br><span class="token keyword">use</span> <span class="token v-string string">v5.16.0</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> YAMLScript<span class="token punctuation">:</span><span class="token punctuation">:</span>FFI<span class="token punctuation">;</span><br><span class="token keyword">use</span> Slurp<span class="token punctuation">;</span><br><span class="token keyword">my</span> <span class="token variable">$program</span> <span class="token operator">=</span> slurp <span class="token string">'hearsay.ys'</span><span class="token punctuation">;</span><br><span class="token keyword">say</span> YAMLScript<span class="token punctuation">:</span><span class="token punctuation">:</span>FFI<span class="token operator">-></span>new<span class="token operator">-></span>load<span class="token punctuation">(</span><span class="token variable">$program</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre><pre class="language-bash"><code class="language-bash">$ perl hearsay.pl<br>I heard that @ethiraric uses YAMLScript <span class="token keyword">in</span> their Rust code<span class="token operator">!</span><br>$ perl hearsay.pl<br>I heard that @ingydotnet uses YAMLScript <span class="token keyword">in</span> their Python code<span class="token operator">!</span></code></pre><p>Just like the Python binding, the Perl module has a <code>load</code> method that takes a YAMLScript program as a string and returns the result as a Perl data structure.</p><p>Install YAMLScript with:</p><pre class="language-bash"><code class="language-bash">$ cpanm YAMLScript</code></pre><p>Also like the Python binding, the Perl module (and all the other bindings) currently requires that you install <code>libyamlscript.so</code> yourself.</p><p>You can do this easily with:</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> <span class="token parameter variable">-s</span> https://yamlscript.org/install-libyamlscript <span class="token operator">|</span> <span class="token function">bash</span></code></pre><p>Remember that this installs to <code>/usr/local/lib</code> by default, so you'll need to run this as root. (Or use the PREFIX option and set <code>LD_LIBRARY_PATH</code> yourself.)</p><h3>Rust</h3><p>@ethiraric is a Rust programmer who dropped by the <a href="https://matrix.to/#/#chat:yaml.io">YAML matrix chat</a> a couple of weeks ago looking to improve Rust's YAML support. I told him about YAMLScript and suggested he write a Rust binding for it since it's just one FFI call.</p><p>He did and today we get to show it off.</p><p>Rust needs a bit more setup than Perl, but it's still pretty easy.</p><p>First run <code>cargo new hearsay</code> to create a new Rust project. Then edit <code>hearsay/Cargo.toml</code> to look like this:</p><pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span><br><span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"hearsay"</span><br><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span><br><span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2021"</span><br><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><br><span class="token key property">yamlscript</span> <span class="token punctuation">=</span> <span class="token string">"0.1.2"</span></code></pre><p>Then edit <code>hearsay/src/main.rs</code> to look like this:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token string">"hearsay.ys"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token namespace">yamlscript<span class="token punctuation">::</span></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{output}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Now run <code>cargo run</code> and you should see something like this:</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">cargo</span> run<br>    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.01s<br>     Running <span class="token variable"><span class="token variable">`</span>target/debug/hearsay<span class="token variable">`</span></span><br><span class="token punctuation">{</span><span class="token string">"data"</span><span class="token builtin class-name">:</span><span class="token string">"I heard that @ethiraric uses YAMLScript in their Python code!"</span><span class="token punctuation">}</span></code></pre><p>That's not quite right, but that's where things are at this moment. The <code>load</code> function is returning a JSON string, but it should be returning a Rust data structure for whatever was under the <code>&quot;data&quot;</code> JSON key. I'm sure @ethiraric will fix it soon!!!</p><p>It's actually fortunate that the Rust binding is not working yet, because it shows us <em>how</em> libyamlscript actually works.</p><p>The libyamlscript library currently has a single function that takes a YAMLScript string and returns a JSON string. Internally it compiles the YAMLScript to Clojure and evaluates the code using SCI. Then it converts the result to JSON and returns it. If the evaluation fails it returns JSON with all the error information under an <code>&quot;error&quot;</code> key. If successful, it returns JSON with all the result information under a <code>&quot;data&quot;</code> key.</p><p>The above call was successful, so that's why we see our expected result under the <code>&quot;data&quot;</code> key.</p><h3>Raku</h3><p>Raku is the new name for Perl 6. It's a completely different language than Perl 5, but it's still a lot like Perl.</p><p>@tony-o is a Raku programmer and my personal friend IRL for many years now. He really loves YAMLScript and wants to work on the language as a whole. Writing a Raku binding was a perfect way to get him started.</p><p>You can install the Raku binding with:</p><pre class="language-bash"><code class="language-bash">$ zef <span class="token function">install</span> YAMLScript</code></pre><p>Here's the example Raku program:</p><pre class="language-perl"><code class="language-perl"><span class="token keyword">use</span> YAMLScript<span class="token punctuation">;</span><br><span class="token keyword">my</span> <span class="token variable">$program</span> <span class="token operator">=</span> slurp <span class="token string">'hearsay.ys'</span><span class="token punctuation">;</span><br><span class="token keyword">my</span> YAMLScript <span class="token variable">$ys</span> <span class="token operator">.=</span> new<span class="token punctuation">;</span><br><span class="token keyword">say</span> <span class="token variable">$ys</span><span class="token operator">.</span>load<span class="token punctuation">(</span><span class="token variable">$program</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre><p>Then you can run our hearsay program like this:</p><pre class="language-bash"><code class="language-bash">$ <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/usr/local/lib raku hearsay.raku<br>I heard that @tony-o uses YAMLScript <span class="token keyword">in</span> their Python code<span class="token operator">!</span></code></pre><p>The Raku effort was a two person job. A big shout out to @vendethiel for helping @tony-o get the Raku binding working right.</p><p>Ven, as we call him, is someone I've known of and highly respected for many years. He was a major contributor to both CoffeeScript and Raku which have permanent places in my heart. He's Polyglot to the core and possibly more <a href="https://acmeism.org">Acmeist</a> than Ingy!</p><p>But my biggest thanks to Ven is for being my daily sounding board and protaganist for YAMLScript. He encourages my good ideas even when they are ambitious and crazy sounding. Every time he's disagreed with me, he's been right... Even if it sometimes takes me a while to see it.</p><p>Everyone in this penuiltimate advent blog post is a hero to me and definitely on Santa's nice list!!! (as far as I'm concerned)</p><p>Please do join me tomorrow for the final post of the YAMLScript Advent Blog 2023!</p><p>&nbsp;</p><details><summary style="color:#888">Santa's little secrets...</summary><p>In December 2023 YAMLScript is a work in progress.</p><p>This is not to say that it's a toy proof of concept. It has a working compiler, runtime and CLI. It has unit tests that must pass for every commit pushed to the main branch. It's well thought out and has a clear direction that I continually vet with a small group of talented and trusted people. It has regular <a href="https://github.com/yaml/yamlscript/releases">releases</a>.</p><p>But that in turn not to say that you should use it in production today. I encourage you to start playing with it, and I'm committed to backwards compatibility for stable releases. But we're not quite there yet. Caveat usor!</p><p>YAMLScript is evolving fast. While I'm writing these posts, I'm also writing the code for new features and fixing bugs as I go. I've had the Advent plan for over a month now, and I had planned to be further along before December 1st, but such are the time estimates of hackers.</p><p>I am attempting to make sure that the code examples in these posts are always using the implemented features, but sometimes I may fall a few hours behind. Often I need to write the examples using code patterns that actually work but are not the ones I preferred to best make a point.</p><p>As I fix bugs, implement features and tweak the language, I will update the posts accordingly. If you see something that bugs you, try taking another look after a few days. It probably bugged me too!</p><p>Be patient with me.</p><p>If I had to guess, I'd say that YAMLScript v0 will be have a stable release sometime before March 2024. I'll continue blogging the progress as I go, so it shouldn't be hard for you to decide when to start using YAMLScript for real.</p><p>Overall the whole thing is going extremely well, and I'm having a lot of fun. It's important to be transparent with you about where things are at.</p><p>Stick with me... This is going to be awesome!</p><p>— Ingy döt Net</p></details></main><aside class="post__aside"><div class="post__tags"><a href="/tags/blog/">#blog</a> <a href="/tags/advent-2023/">#advent-2023</a></div><nav class="post__pagination"><a href="/posts/advent-2023/dec-22/"><span>←</span> <span>Flip Flops</span> </a><a href="/posts/advent-2023/dec-24/"><span>Wrapped and Ready</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>