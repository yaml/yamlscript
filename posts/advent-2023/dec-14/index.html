<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/posts/advent-2023/dec-14/"><link href="/assets/main.568c13b05248bebc365e.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Stocking Stuffers | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Stocking Stuffers"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/posts/advent-2023/dec-14/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="Stocking Stuffers by Ingy döt Net | 14 Dec 2023 | 5 min read It&#39;s always nice to get a little something extra in your stocking whilst..."><meta property="og:description" content="Stocking Stuffers by Ingy döt Net | 14 Dec 2023 | 5 min read It&#39;s always nice to get a little something extra in your stocking whilst..."><meta name="description" content="Stocking Stuffers by Ingy döt Net | 14 Dec 2023 | 5 min read It&#39;s always nice to get a little something extra in your stocking whilst..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/doc">Docs</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Stocking Stuffers</h1><div class="post__details">by <a href="/about/#ingydotnet">Ingy döt Net</a> <span>| </span><time datetime="2023-12-14">14 Dec 2023 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><p>It's always nice to get a little something extra in your stocking whilst waiting for the big guy to show up on the big day.</p><p>Learning eveything you need to know about YAMLScript in 24 days is a tall order. I still have a quite a bit to learn about it myself! :-)</p><p>It helps to learn the small stuff first.</p><h3>Welcome to Day 14 of YAMLScript Advent 2023!</h3><p>Today we'll look at some of the little things that make YAMLScript a joy to work with. We'll go over some of the basic syntax, semantics, features and commands of YAMLScript.</p><p>What if... What if? What <code>if</code>!</p><p>Let's start out by looking at some of the various ways you can write the ubiquituous <code>if</code> statement in YAMLScript.</p><p>To set the tone here, let's code an <code>if</code> in another simple language, Python, since it can often be used as pseudocode:</p><pre class="language-python"><code class="language-python"><span class="token keyword">if</span> a <span class="token operator">></span> b<span class="token punctuation">:</span><br>  <span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token string">" is greater than "</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><br><span class="token keyword">else</span><span class="token punctuation">:</span><br>  <span class="token keyword">print</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token string">" is greater than or equal to "</span> <span class="token operator">+</span> a<span class="token punctuation">)</span></code></pre><p>Abstractly we are saying that if some condition is true, then do one thing, otherwise do another thing.</p><p>Since YAMLScript compiles to Clojure, it's important to understand how Clojure does <code>if</code>. Let's look at the same code in Clojure.</p><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">></span> a b<span class="token punctuation">)</span><br>  <span class="token punctuation">(</span><span class="token keyword">println</span> <span class="token punctuation">(</span><span class="token keyword">str</span> a <span class="token string">" is greater than "</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">(</span><span class="token keyword">println</span> <span class="token punctuation">(</span><span class="token keyword">str</span> b <span class="token string">" is greater than or equal to "</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>The Clojure code has an <code>if</code> command followed by:</p><ul><li>a condition form</li><li>a form to run if the condition is true</li><li>a form to run if the condition is false (optional)</li></ul><p>This is how all <code>if</code> statements look in Clojure.</p><p>There are many ways to do the same thing in YAMLScript. Here's a one good way to do it:</p><pre class="language-yaml"><code class="language-yaml"><span class="token tag">!yamlscript/v0</span><br><span class="token key atrule">if a > b</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">"$a is greater than $b"</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">"$b is greater than or equal to $a"</span></code></pre><blockquote><p>All the YAMLScript examples in this post use code-mode which requires the <code>!yamlscript/v0</code> tag at the top of the file. We'll leave it out of the rest of the examples for brevity.</p></blockquote><p>Let's see what happens when we compile that YAMLScript program:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-c</span> if.ys<br><span class="token punctuation">(</span>if<br> <span class="token punctuation">(</span><span class="token operator">></span> a b<span class="token punctuation">)</span><br> <span class="token punctuation">(</span>say <span class="token punctuation">(</span>str a <span class="token string">" is greater than "</span> b<span class="token punctuation">))</span><br> <span class="token punctuation">(</span>say <span class="token punctuation">(</span>str b <span class="token string">" is greater than or equal to "</span> a<span class="token punctuation">))</span><span class="token punctuation">)</span></code></pre><p>We get the exact same Clojure code as above! (in a slightly different format) Note that <code>say</code> is an alternate way to write <code>println</code> in YAMLScript, but you can use <code>println</code> if you prefer to type more.</p><p>The <code>if</code> command is an interesting YAML mapping. The key has both the <code>if</code> command symbol and the condition form in it. The value is another YAML mapping with two pairs: one for the &quot;then&quot; form and one for the &quot;else&quot; form.</p><blockquote><p>Notice that both pairs have the same key, <code>say</code>. Duplicate keys aren't allowed in YAML, but they are allowed in YAMLScript code-mode. That's because the YAMLScript compiler (a fancy YAML loader) isn't loading the mapping into a data structure, but rather into an AST. For the AST, the &quot;duplicate keys&quot; are no problem, because they're not actually being used as mapping keys. By contrast, in YAMLScript data-mode, duplicate keys are not allowed because they are actually being used as mapping keys (like normal YAML).</p></blockquote><p>YAMLScript code-mode does everything using only YAML block mappings or scalars. Using sequences or flow nodes is not allowed in code-mode.</p><details><summary><strong style="color:green">Quick YAML Jargon Review</strong></summary><hr><ul><li>node - a mapping, sequence or scalar</li><li>collection - a mapping or sequence data structure</li><li>mapping - a key/value data structure; aka hash, dictionary, object,</li><li>sequence - an ordered list of values; aka array, list, vector</li><li>scalar - a single value; aka string, number, boolean, null</li><li>block - the normal YAML indented style (with <code>-</code> before each sequence node)</li><li>flow - the JSON looking style with braces and brackets</li><li>plain scalar - a scalar that is not quoted</li><li>double quoted scalar - a scalar that is quoted with double quotes</li><li>single quoted scalar - a scalar that is quoted with single quotes</li><li>literal scalar - a scalar that is quoted with <code>|</code></li><li>folded scalar - a scalar that is quoted with <code>&gt;</code></li><li>pair - a key/value pair in a mapping</li><li>key - the first part of a pair or lefthand side</li><li>value - the second part of a pair or righthand side</li></ul><blockquote><p>YAML block mapping values can span multiple lines, and can start after the line with the key and the <code>:</code> separator.</p></blockquote><hr></details><p>Let's write the <code>if</code> statement using YAML scalars instead of a mapping:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">if a > b</span><span class="token punctuation">:</span><br>  say("$a is greater than $b")<br>  say("$b is greater than or equal to $a")</code></pre><p>If you <code>ys --compile</code> this you get the exact same thing as the previous compile. In this case the value of the top YAML mapping is just a scalar. Even though it is 2 lines of code, it represents a a single long line containing two function calls, one for &quot;then&quot; and one for &quot;else&quot;.</p><p>So that's 2 ways to write the <code>if</code> statement in YAMLScript. The two best ways. There are several other ways to do it that are less readable but still valid syntax. And there's nothing special about this being an <code>if</code> statement; the same rules apply to all YAMLScript commands in general.</p><h3>General Syntax Rules</h3><p>By default in code-mode, a mapping is a set of pairs where each pair compiles to a form:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">a</span><span class="token punctuation">:</span> b c d<br><span class="token key atrule">a b</span><span class="token punctuation">:</span> c d<br><span class="token key atrule">a b c</span><span class="token punctuation">:</span> d<br><span class="token key atrule">a b c d</span><span class="token punctuation">:</span><br><span class="token key atrule">=></span><span class="token punctuation">:</span> (a b c d)<br><span class="token key atrule">=></span><span class="token punctuation">:</span> a(b c d)<br><span class="token key atrule">a</span><span class="token punctuation">:</span><br>  <span class="token key atrule">=></span><span class="token punctuation">:</span> b<br>  <span class="token key atrule">=></span><span class="token punctuation">:</span> c<br>  <span class="token key atrule">=></span><span class="token punctuation">:</span> d<br><span class="token key atrule">a b</span><span class="token punctuation">:</span><br>  <span class="token key atrule">=></span><span class="token punctuation">:</span> c<br>  <span class="token key atrule">=></span><span class="token punctuation">:</span> d</code></pre><blockquote><p><em><strong>This is important to understand!</strong></em></p></blockquote><p>All the pairs above compile to the same Clojure form: <code>(a b c d)</code>, which is calling a function <code>a</code> with 3 arguments: <code>b</code>, <code>c</code> and <code>d</code>.</p><p>The <code>=&gt;</code> symbol is a special YAMLScript key symbol that can be used when you only care about using a scalar in that spot. Since YAMLScript always needs to be valid YAML, this can often be useful.</p><p>So now you can see what I was talking about with all the ways to write an <code>if</code> statement. Only the <code>a b: c d</code> forms look normal to most programmers.</p><h3>YAMLScript Loops</h3><p>Let's look at another common control structure: looping.</p><p>There are a lot of ways to do loops in Clojure (thus YAMLScript). They have lots of subtle differences and properties. We'll just cover one or two here for now. (We're not even halfway through December yet!)</p><p>Here's a simple <code>for</code> loop in Python that prints the numbers 0 through 4:</p><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></code></pre><p>Here's the same loop in Clojure:</p><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">[</span>i <span class="token punctuation">(</span><span class="token keyword">range</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><br>  <span class="token punctuation">(</span><span class="token keyword">println</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>So in YAMLScript we can do this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">for i range(5)</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> i</code></pre><p>When we compile this we get:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-c</span> for.ys<br><span class="token punctuation">(</span>for <span class="token punctuation">[</span>i <span class="token punctuation">(</span>range <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>say i<span class="token punctuation">))</span></code></pre><p>Let's run it:</p><pre class="language-bash"><code class="language-bash">$ ys for.ys<br>$</code></pre><p>Nothing happened!</p><p>This has to do with some of the more advanced understanding of Clojure. Specifically laziness and evaluation.</p><p>To be honest, the Clojure code I wrote above would not print anything depending on how you ran it. If you ran it in the Clojure REPL or as a one liner it would print the numbers. If you ran it as a program it would not print anything.</p><p>To make things work as expected in the REPL Clojure forces the lazy structures to be evaluated.</p><p>Clojure also has a <code>doall</code> function that forces evaluation. Let's use that in our YAMLScript program:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">doall</span><span class="token punctuation">:</span><br>  <span class="token key atrule">for i range(5)</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> i</code></pre><p>Now when we compile and run it we get:</p><pre class="language-bash"><code class="language-bash">$ ys for.ys<br><span class="token number">0</span><br><span class="token number">1</span><br><span class="token number">2</span><br><span class="token number">3</span><br><span class="token number">4</span></code></pre><p>Success! But at what cost? That's a lot of code to print 5 numbers.</p><p>YAMLScript has a nicer way to do this. It has an <code>each</code> command that calls <code>doall</code> and <code>for</code> for you:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">each i range(5)</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> i</code></pre><p>or:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">each i range(5)</span><span class="token punctuation">:</span> say(i)</code></pre><p>or:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">each i (0 .. 4)</span><span class="token punctuation">:</span> say(i)</code></pre><p>Doesn't it seem strange to you that <code>(range 5)</code> really means 0 to 4? There are technical reasons for this, but it's not very intuitive.</p><p>YAMLScript's <code>..</code> operator does what you told it to. It really just compiles to <code>(ys.std/rng 0 4)</code> which is a standard YAMLScript function that returns a range from 0 to 4.</p><p>It also works in reverse:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-e</span> <span class="token string">'each i (4 .. 0): say(i)'</span><br><span class="token number">4</span><br><span class="token number">3</span><br><span class="token number">2</span><br><span class="token number">1</span><br><span class="token number">0</span></code></pre><p>To do that in Clojure you'd have to write:</p><pre class="language-clojure"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">doall</span><br>  <span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">[</span>i <span class="token punctuation">(</span><span class="token keyword">range</span> <span class="token number">4</span> -<span class="token number">1</span> -<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><br>    <span class="token punctuation">(</span><span class="token keyword">println</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Sheesh!</p><hr><p>I know that was only 2 or 3 things in your stocking, but they were quite a lot to chew on. Maybe we'll have to stuff your stocking a couple more times this month!</p><p>See you tomorrow for Day 15 of YAMLScript Advent 2023!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/blog/">#blog</a> <a href="/tags/advent-2023/">#advent-2023</a></div><nav class="post__pagination"><a href="/posts/advent-2023/dec-13/"><span>←</span> <span>History Lesson</span> </a><a href="/posts/advent-2023/dec-15/"><span>Naughty is Nice!</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>