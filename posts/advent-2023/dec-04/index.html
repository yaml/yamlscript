<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/posts/advent-2023/dec-04/"><link href="/assets/main.568c13b05248bebc365e.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Santa&#39;s Big Secret | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Santa&#39;s Big Secret"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/posts/advent-2023/dec-04/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="Santa&amp;#39;s Big Secret by Ingy döt Net | 04 Dec 2023 | 5 min read I&#39;ve got a little secret to tell you. I&#39;ve been hiding a little something..."><meta property="og:description" content="Santa&amp;#39;s Big Secret by Ingy döt Net | 04 Dec 2023 | 5 min read I&#39;ve got a little secret to tell you. I&#39;ve been hiding a little something..."><meta name="description" content="Santa&amp;#39;s Big Secret by Ingy döt Net | 04 Dec 2023 | 5 min read I&#39;ve got a little secret to tell you. I&#39;ve been hiding a little something..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/doc">Docs</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Santa&#39;s Big Secret</h1><div class="post__details">by <a href="/about/#ingydotnet">Ingy döt Net</a> <span>| </span><time datetime="2023-12-04">04 Dec 2023 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><p>I've got a little secret to tell you. I've been hiding a little something from you. Even that's a lie. I've actually been hiding something very very big something from you.</p><blockquote><h3>*** YAMLScript is a Lisp! *****</h3></blockquote><h3>Welcome to day 4 of YAMLScript Advent 2023!</h3><p>Today is Monday and Monday's are made for big headlines.</p><p>That's right. Not only is YAMLScript a Lisp, it's a very specific and modern Lisp. It's a Lisp that has a community and conferences and books and jobs that pay people to write code in Lisp!</p><p>If you know the slightest thing about Lisp, you must think I'm crazy. YAMLScript is YAML, and YAML is no Lisp. It's almost the Anti-Lisp incarnate.</p><p>OK. Here's the deal...</p><blockquote><h3>YAMLScript <em>is</em> Clojure</h3></blockquote><p>There you go. The secret is out. Every YAMLScript program is program is a Clojure program.</p><p>Every time you run (or load!) a YAMLScript program, it compiles to Clojure code that is then run by a Clojure runtime engine. I can prove it!</p><p>Consider this YAMLScript program:</p><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># hw.ys</span><br><span class="token tag">!yamlscript/v0</span><br><span class="token key atrule">println</span><span class="token punctuation">:</span> <span class="token string">'Hello, world!'</span></code></pre><p>Let's run it:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">--run</span> hw.ys<br>Hello, world<span class="token operator">!</span></code></pre><p>No surprises there. Now let's first compile it to Clojure:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">--compile</span> hw.ys<br><span class="token punctuation">(</span>println <span class="token string">"Hello, world!"</span><span class="token punctuation">)</span></code></pre><p>Looks pretty Lispy to me. Now let's run the Clojure code:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-c</span> hw.ys <span class="token operator">|</span> clojure <span class="token parameter variable">-M</span> -<br>Hello, world<span class="token operator">!</span></code></pre><p>It works! YAMLScript really <em>is</em> Clojure. And Clojure most definitely <em>is</em> a Lisp. Soooooo...?! Yeah, you get it. QED, baby!</p><h3>What is Clojure?</h3><p>Oh wait, you don't know what Clojure is? Or maybe you need a quick refresher?</p><p>Clojure is a modern Lisp that runs on the JVM. It was created by this really interesting guy named <a href="https://en.wikipedia.org/wiki/Rich_Hickey">Rich Hickey</a> whom I've actually met many times...</p><p>...on YouTube.</p><p>I don't typically watch a lot of programming videos, but I've seen at least a dozen of his. I encourage you to watch some too. Or at least peruse some of his <a href="https://gist.github.com/reborg/dc8b0c96c397a56668905e2767fd697f">various opinions on varying programming topics</a>.</p><p>Rich programmed professionally in Java for many years. One day he decided that he couldn't take it anymore. He took a couple years off and he changed the world. The Java world anyway.</p><p>Java is a widely used imperative programming language, with mutable data structures and a noisy syntax. Clojure by contrast is a functional programming language, with immutable data structures and a very clean syntax. You can use any Java library directly from Clojure and vice versa, making Clojure an extremely practical language.</p><p>In a phrase: <strong>&quot;Clojure makes Java not suck&quot;</strong>. (Ingy's words, not Rich's)</p><h3>What does this all have to say about YAMLScript?</h3><p><strong>Yesterday we learned that all JSON is YAML and that almost all YAML is YAMLScript. Does this means that all JSON is Clojure?</strong></p><p>Actually it kind of does.</p><p>Let's compile some JSON with <code>ys</code>:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-md</span> <span class="token parameter variable">-ce</span> <span class="token string">'{ "foo": "bar", "baz": [1, 2, null, true] }'</span><br><span class="token punctuation">{</span><span class="token string">"foo"</span> <span class="token string">"bar"</span>, <span class="token string">"baz"</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> nil true<span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>Yep. That's Clojure. It also happens to be EDN, which is Clojure's native data format.</p><blockquote><p>Note: The <code>-md</code> option tells <code>ys</code> not to add the <code>!yamlscript/v0</code> tag that it usually does with <code>-e</code> to make your YS life easier. We'll learn more about <code>-m</code> another time.</p></blockquote><p><strong>Lisp puts parentheses around everything. Does that mean that YAMLScript does too?</strong></p><p>Good question. The answer may surprise you. YAMLScript has a lot of different ways to express code. It embraces diversity. (As long as that diversity can be written as YAML!) One of the ways to write code in YAMLScript is in Clojure syntax!</p><p>This YAMLScript prints 3 symbol names available in the current namespace:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-e</span> <span class="token string">'(say (take (+ 1 2) (keys (ns-map NS))))'</span><br><span class="token punctuation">(</span>+' decimal? sort-by<span class="token punctuation">)</span></code></pre><p>In Lisp every expression (function call) is a paranthesized list where the first word is the function name and the rest are the arguments. That means arithmetic expressions like <code>1 + 2</code> are written as <code>(+ 1 2)</code>.</p><p>This feels very natural to Lisp programmers, but it can be a bit of a shock to the rest of us. YAMLScript offers alternate ways (called ysexprs or YeS Expressions) to write these Lisp basic forms.</p><p>We'll learn the gritty details in another post, but here's the basics:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">=></span><span class="token punctuation">:</span> 1 + 2               <span class="token comment"># (+ 1 2)   ;; + - * /</span><br><span class="token key atrule">=></span><span class="token punctuation">:</span> 3 * 4 * 5           <span class="token comment"># (* 3 4 5) ;; if operators are the same</span><br><span class="token key atrule">=></span><span class="token punctuation">:</span> foo(bar(42 true))   <span class="token comment"># (foo (bar 42 true))</span></code></pre><p>We could write the above YAMLScript expression like this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">say</span><span class="token punctuation">:</span><br>  <span class="token key atrule">take</span><span class="token punctuation">:</span><br>    <span class="token key atrule">+</span><span class="token punctuation">:</span> 1 2<br>    <span class="token key atrule">keys</span><span class="token punctuation">:</span><br>      <span class="token key atrule">ns-map</span><span class="token punctuation">:</span> NS</code></pre><p>Both YAMLScript forms compile to the same Clojure code.</p><p>Basically at any level of YAML in YAMLScript, you can switch to using Clojure. Since an entire YAML document can be a single string you can sometimes use an entire Clojure file as a YAMLScript program. As long as it's valid YAML, of course.</p><p><strong>Clojure is a JVM Language. Does that mean that YAMLScript is a JVM language?</strong></p><p>This one is crazy. YAMLScript does not need the JVM or anything Java whatsoever. The <code>ys</code> binary is a native machine code executable. The <code>libyamlscript</code> shared library is also native machine code and thus can be FFI bound to almost any programming language.</p><p>You don't even need to have Java installed on your system to <em>build</em> YAMLScript. That's a little fib. The build system always downloads a Java build system and then discards it when it's done. The point is that to build <code>ys</code> you don't need to set up any prerequisites. It just works.</p><p>How is this possible? It's all thanks to <a href="https://www.graalvm.org/">GraalVM</a> which is, as one of my YS friends puts it, &quot;a cheat code&quot;! GraalVM's <code>native-image</code> compiler can magically turn anything Java into native machine code on Linux, macOS and Windows. <strong>Wow!</strong></p><p>A very noticeable difference between YAMLScript and Clojure is startup time:</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">time</span> ys <span class="token parameter variable">-e</span> <span class="token number">1</span><br>real    0m0.044s<br>$ <span class="token function">time</span> perl <span class="token parameter variable">-e</span> <span class="token number">1</span>    <span class="token comment"># for comparison</span><br>real    0m0.048s<br>$ <span class="token function">time</span> clojure <span class="token parameter variable">-M</span> <span class="token parameter variable">-e</span> <span class="token number">1</span><br><span class="token number">1</span><br>real    0m0.637s</code></pre><p>Clojure's not 10 times slower than YS (or Perl). It just takes 10 times longer to start up a JVM.</p><p><strong>Do you need to know Clojure to use YAMLScript?</strong></p><p>No, not at first. Proof? I just got through 3 days of YAMLScript Advent without mentioning Clojure once.</p><p>If you just want to make your out of control YAML files more manageable, composable and maintainable, you can easily learn how to wield YAMLScript without knowing a lick of Clojure.</p><p>When you need more power it's there for you because Clojure is there for you. But you have to learn some new things first.</p><p>I honestly think YS can be a great introduction to Clojure. I think that Clojure is a great introduction to Lisp, working with immutable data structures, and functional programming. And I think that learning these things will make you a better programmer in whatever language you use.</p><p>YAML has always been about making things easier in all programming languages. My love for Clojure is that it has the right parts to make YAML more powerful in all those same languages. I have no desire to see the whole world switch to Clojure (or anything else). Clojure is a great gift and I hope YS can help more people benefit from it in the languages and technologies they already use.</p><p><strong>How does YAMLScript benefit from building over Clojure?</strong></p><p>In a nutshell, it makes YAMLScript a complete, robust, battle tested, and well-documented language from the get go. Rich knew that to make a new language in 2006 he needed to build on something that was already a big deal; the Java ecosystem.</p><p>I feel the exact same way about YAMLScript.</p><p>YAMLScript is poised to take YAML to a whole new level. This is all thanks to the shoulders of these specific giants:</p><ul><li><a href="https://yaml.org/">YAML</a></li><li><a href="https://clojure.org/">Clojure</a></li><li><a href="https://bitbucket.org/asomov/snakeyaml/src/master/">SnakeYAML</a></li><li><a href="https://github.com/babashka/sci">Small Clojure Interpreter (SCI)</a></li><li><a href="https://www.graalvm.org/">GraalVM</a></li></ul><p>I'll have more to say about each of these in future posts. For now, I'll just say that I'm extremely grateful for all of them.</p><p>I'll see you tomorrow for day 5 of YAMLScript Advent 2023!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/blog/">#blog</a> <a href="/tags/advent-2023/">#advent-2023</a></div><nav class="post__pagination"><a href="/posts/advent-2023/dec-03/"><span>←</span> <span>Load em Up!</span> </a><a href="/posts/advent-2023/dec-05/"><span>Unwrapping Gifts</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>