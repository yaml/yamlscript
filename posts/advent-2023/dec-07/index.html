<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/posts/advent-2023/dec-07/"><link href="/assets/main.7eeaf7bb0c5b5da98e70.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Sharpen Your Tools | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Sharpen Your Tools"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/posts/advent-2023/dec-07/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="Sharpen Your Tools by Ingy döt Net | 07 Dec 2023 | 5 min read Wanna make some fun toys with YAMLScript? You&#39;ll need some sharp tools. You..."><meta property="og:description" content="Sharpen Your Tools by Ingy döt Net | 07 Dec 2023 | 5 min read Wanna make some fun toys with YAMLScript? You&#39;ll need some sharp tools. You..."><meta name="description" content="Sharpen Your Tools by Ingy döt Net | 07 Dec 2023 | 5 min read Wanna make some fun toys with YAMLScript? You&#39;ll need some sharp tools. You..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Sharpen Your Tools</h1><div class="post__details">by <a href="/about/#ingydotnet">Ingy döt Net</a> <span>| </span><time datetime="2023-12-07">07 Dec 2023 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><p>Wanna make some fun toys with YAMLScript? You'll need some sharp tools. You think those elves make all those toys with dull tools?</p><p>The CLI tool <code>ys</code> is the main tool you'll use to work with YAMLScript. Today we'll learn about all the things you can do with it.</p><h3>Welcome to Day 7 of the YAMLScript Advent Calendar</h3><p>On Tuesday you learned how to install YAMLScript. Reminder, here's the quick way to install the latest version:</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> https://yamlscript.org/install-ys <span class="token operator">|</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=~</span>/.yamlscript <span class="token function">bash</span><br>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/.yamlscript/bin:<span class="token environment constant">$PATH</span><br>$ ys <span class="token parameter variable">--version</span><br>YAMLScript v0.1.21</code></pre><p>The best first command to run is <code>ys --help</code>:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">--help</span><br>ys - The YAMLScript <span class="token punctuation">(</span>YS<span class="token punctuation">)</span> Command Line Tool<br><br>Usage: ys <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>file<span class="token punctuation">]</span><br><br>Options:<br>  -r, <span class="token parameter variable">--run</span>                Compile and evaluate a YAMLScript <span class="token function">file</span> <span class="token punctuation">(</span>default<span class="token punctuation">)</span><br>  -l, <span class="token parameter variable">--load</span>               Output the evaluated YAMLScript value<br>  -c, <span class="token parameter variable">--compile</span>            Compile YAMLScript to Clojure<br>  -e, <span class="token parameter variable">--eval</span> YSEXPR        Evaluate a YAMLScript expression<br>  -C, <span class="token parameter variable">--clj</span>                Treat input as Clojure code<br><br>  -m, <span class="token parameter variable">--mode</span> MODE          Add a mode tag: code, data, or bare <span class="token punctuation">(</span>only <span class="token keyword">for</span> --eval/-e<span class="token punctuation">)</span><br>  -p, <span class="token parameter variable">--print</span>              Print the result of <span class="token parameter variable">--run</span> <span class="token keyword">in</span> code mode<br><br>  -o, <span class="token parameter variable">--output</span>             Output <span class="token function">file</span> <span class="token keyword">for</span> <span class="token parameter variable">--load</span> or <span class="token parameter variable">--compile</span><br>  -t, <span class="token parameter variable">--to</span> FORMAT          Output <span class="token function">format</span> <span class="token keyword">for</span> <span class="token parameter variable">--load</span><br><br>  -J, <span class="token parameter variable">--json</span>               Output JSON <span class="token keyword">for</span> <span class="token parameter variable">--load</span><br>  -Y, <span class="token parameter variable">--yaml</span>               Output YAML <span class="token keyword">for</span> <span class="token parameter variable">--load</span><br>  -E, <span class="token parameter variable">--edn</span>                Output EDN <span class="token keyword">for</span> <span class="token parameter variable">--load</span><br><br>  -X, <span class="token parameter variable">--debug</span>              Debug mode: print full stack trace <span class="token keyword">for</span> errors<br>  -x, --debug-stage STAGE  Display the result of stage<span class="token punctuation">(</span>s<span class="token punctuation">)</span><br>      <span class="token parameter variable">--version</span>            Print version and <span class="token builtin class-name">exit</span><br>  -h, <span class="token parameter variable">--help</span>               Print this <span class="token builtin class-name">help</span> and <span class="token builtin class-name">exit</span></code></pre><h3>Ready, set, actions!</h3><p>The first thing to notice is that <code>ys</code> has 3 &quot;actions&quot;:</p><ul><li><code>--run</code> (default) - Compile and evaluate a YAMLScript file</li><li><code>--load</code> - Output the evaluated YAMLScript value as JSON (by default)</li><li><code>--compile</code> - Compile YAMLScript code to Clojure code</li></ul><p>For each action you'll need some YAMLScript source code. This can come from 3 different places:</p><ul><li>The <code>--eval</code> (<code>-e</code>) option - specifies a line of YAMLScript code. You can use this option multiple times to specify multiple lines of code.</li><li>A file path - specify a path to a file containing YAMLScript code.</li><li>Standard input - specify <code>-</code> as the file path to read YAMLScript code from standard input. If no file or <code>-e</code> options are specified, <code>ys</code> will check to see if there is data on stdin. That means you can leave off the <code>-</code> and pipe data into <code>ys</code> like this: <code>echo $'!yamlscript/v0\nsay: &quot;Hello&quot;' | ys</code>. Of course, it doesn't hurt to specify the <code>-</code> anyway.</li></ul><h3>Running Clojure with <code>ys</code></h3><p>Clojure code is often valid YAMLScript code:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">--compile</span> <span class="token parameter variable">-e</span> <span class="token string">'(println (+ 1 2))'</span><br><span class="token punctuation">(</span>println <span class="token punctuation">(</span>+ <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">))</span></code></pre><p>This YAMLScript compiles to the exact same Clojure code.</p><p>If you want the code you run to be considered to be Clojure code (thus not compiled by the yamlscript compiler), you can use the <code>--clj</code> (<code>-C</code>) option. This is useful when you want to test out the YAMLScript runtime envronment directly with Clojure code.</p><p>Also you can pipe the output of <code>ys --compile</code> to <code>ys --clj</code> to run the compiler's Clojure code ouput:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-c</span> <span class="token parameter variable">-e</span> <span class="token string">'say: 123'</span> <span class="token operator">|</span> ys <span class="token parameter variable">-C</span></code></pre><h3>Modes and Formats</h3><p>We learned about modes and the <code>--mode</code> option yesterday. You can set the mode for <code>--eval</code> (<code>-e</code>) code with the <code>--mode</code> (<code>-m</code>) option. The accepted values are <code>code</code> (<code>c</code>), <code>data</code> (<code>d</code>) and <code>bare</code> (<code>b</code>).</p><p>When you &quot;load&quot; YAMLScript using <code>--load</code> you get the result printed to stdout as JSON. These are 3 formatting options to control how the output is displayed:</p><ul><li><code>--json</code> (<code>-J</code>) - Output JSON (default) Note that this JSON is a bit more nicely formatted than the default output.</li><li><code>--yaml</code> (<code>-Y</code>) - Output YAML</li><li><code>--edn</code> (<code>-E</code>) - Output EDN. EDN is Clojure's native data format. It is also valid Clojure code.</li></ul><p>Note that when you specify a formatting option, it implies the <code>--load</code> action.</p><h3>Debugging</h3><p>When you &quot;run&quot; a YAMLScript program it doesn't print anything unless you use a printing command. This isn't surprising; all languages work this way.</p><p>Sometimes you want to know what the final value of the run was. To get this you could print it with <code>say.</code> You can also use the special <code>--print</code> (<code>-p</code>) option, which does exactly that (with less typing)..</p><p>Finally there a 2 special debugging options:</p><ul><li><code>--debug</code> (<code>-X</code>) - Print a full stack trace for errors (more info)</li><li><code>--debug-stage</code> (<code>-x</code>) - Display the result of a stage/stages</li></ul><p>The <code>--debug-stage</code> option is super useful for understanding exactly how YAMLScript code compiles to Clojure code.</p><p>For example, to see the internal AST when compiling some YAMLScript:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-c</span> <span class="token parameter variable">-e</span> <span class="token string">'say: "Hello"'</span> <span class="token parameter variable">-xconstruct</span><br>*** construct output ***<br><span class="token punctuation">{</span>:Lst <span class="token punctuation">[</span><span class="token punctuation">{</span>:Sym say<span class="token punctuation">}</span> <span class="token punctuation">{</span>:Str <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><br><br><span class="token punctuation">(</span>say <span class="token string">"Hello"</span><span class="token punctuation">)</span></code></pre><p>And to see all 7 compilation stages:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">-c</span> <span class="token parameter variable">-e</span> <span class="token string">'say: "Hello"'</span> <span class="token parameter variable">-xall</span><br>*** parse output ***<br><span class="token punctuation">(</span><span class="token punctuation">{</span>:+ <span class="token string">"+MAP"</span>, :<span class="token operator">!</span> <span class="token string">"yamlscript/v0"</span><span class="token punctuation">}</span><br> <span class="token punctuation">{</span>:+ <span class="token string">"=VAL"</span>, :<span class="token operator">=</span> <span class="token string">"say"</span><span class="token punctuation">}</span><br> <span class="token punctuation">{</span>:+ <span class="token string">"=VAL"</span>, :$ <span class="token string">"Hello"</span><span class="token punctuation">}</span><br> <span class="token punctuation">{</span>:+ <span class="token string">"-MAP"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>*** compose output ***<br><span class="token punctuation">{</span>:<span class="token operator">!</span> <span class="token string">"yamlscript/v0"</span>, :% <span class="token punctuation">[</span><span class="token punctuation">{</span>:<span class="token operator">=</span> <span class="token string">"say"</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>:$ <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><br><br>*** resolve output ***<br><span class="token punctuation">{</span>:ysm <span class="token punctuation">(</span><span class="token punctuation">{</span>:ysx <span class="token string">"say"</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>:ysi <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><br><br>*** build output ***<br><span class="token punctuation">{</span>:ysm <span class="token punctuation">(</span><span class="token punctuation">{</span>:Sym say<span class="token punctuation">}</span> <span class="token punctuation">{</span>:Str <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><br><br>*** transform output ***<br><span class="token punctuation">{</span>:ysm <span class="token punctuation">(</span><span class="token punctuation">{</span>:Sym say<span class="token punctuation">}</span> <span class="token punctuation">{</span>:Str <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><br><br>*** construct output ***<br><span class="token punctuation">{</span>:Lst <span class="token punctuation">[</span><span class="token punctuation">{</span>:Sym say<span class="token punctuation">}</span> <span class="token punctuation">{</span>:Str <span class="token string">"Hello"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><br><br>*** print output ***<br><span class="token string">"(say <span class="token entity" title="\&quot;">\"</span>Hello<span class="token entity" title="\&quot;">\"</span>)<span class="token entity" title="\n">\n</span>"</span><br><br><span class="token punctuation">(</span>say <span class="token string">"Hello"</span><span class="token punctuation">)</span></code></pre><p>We'll go over all of these stages in detail in a future post.</p><p>In the meantime, try out your new <code>ys</code> tool and see what you can do with it. The more you use it, the sharper it will get.</p><p>I'll see you tomorrow for day 8 of YAMLScript Advent 2023!</p><p>&nbsp;</p><details><summary style="color:#888">Santa's little secrets...</summary><p>In December 2023 YAMLScript is a work in progress.</p><p>This is not to say that it's a toy proof of concept. It has a working compiler, runtime and CLI. It has unit tests that must pass for every commit pushed to the main branch. It's well thought out and has a clear direction that I continually vet with a small group of talented and trusted people. It has regular <a href="https://github.com/yaml/yamlscript/releases">releases</a>.</p><p>But that in turn not to say that you should use it in production today. I encourage you to start playing with it, and I'm committed to backwards compatibility for stable releases. But we're not quite there yet. Caveat usor!</p><p>YAMLScript is evolving fast. While I'm writing these posts, I'm also writing the code for new features and fixing bugs as I go. I've had the Advent plan for over a month now, and I had planned to be further along before December 1st, but such are the time estimates of hackers.</p><p>I am attempting to make sure that the code examples in these posts are always using the implemented features, but sometimes I may fall a few hours behind. Often I need to write the examples using code patterns that actually work but are not the ones I preferred to best make a point.</p><p>As I fix bugs, implement features and tweak the language, I will update the posts accordingly. If you see something that bugs you, try taking another look after a few days. It probably bugged me too!</p><p>Be patient with me.</p><p>If I had to guess, I'd say that YAMLScript v0 will be have a stable release sometime before March 2024. I'll continue blogging the progress as I go, so it shouldn't be hard for you to decide when to start using YAMLScript for real.</p><p>Overall the whole thing is going extremely well, and I'm having a lot of fun. It's important to be transparent with you about where things are at.</p><p>Stick with me... This is going to be awesome!</p><p>— Ingy döt Net</p></details></main><aside class="post__aside"><div class="post__tags"><a href="/tags/blog/">#blog</a> <a href="/tags/advent-2023/">#advent-2023</a></div><nav class="post__pagination"><a href="/posts/advent-2023/dec-06/"><span>←</span> <span>Modes of Transportation</span> </a><a href="/posts/advent-2023/dec-08/"><span>Going to the Library</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>