<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/doc/ys-taptest/"><link href="/assets/main.089cde16aad3ee63f22f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>YAMLScript TAP Testing Library | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="YAMLScript TAP Testing Library"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/doc/ys-taptest/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="YAMLScript TAP Testing Library This library provides an implementation of the Test Anything Protocol (TAP) for YAMLScript. It&#39;s a really..."><meta property="og:description" content="YAMLScript TAP Testing Library This library provides an implementation of the Test Anything Protocol (TAP) for YAMLScript. It&#39;s a really..."><meta name="description" content="YAMLScript TAP Testing Library This library provides an implementation of the Test Anything Protocol (TAP) for YAMLScript. It&#39;s a really..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript-logo.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/doc">Docs</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>YAMLScript TAP Testing Library</h1></header><main class="post__content"><p>This library provides an implementation of the <a href="https://testanything.org/">Test Anything Protocol (TAP)</a> for YAMLScript.</p><p>It's a really clean way to write unit tests for your YAMLScript code.</p><p>Here's an example of a simple test file (test-1.t):</p><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#!/usr/bin/env ys-0</span><br><br><span class="token key atrule">require ys::taptest</span><span class="token punctuation">:</span> test done<br><br>hash1 =<span class="token punctuation">:</span><span class="token punctuation">:</span><br>  <span class="token key atrule">foo</span><span class="token punctuation">:</span> one<br>  <span class="token key atrule">bar</span><span class="token punctuation">:</span> two<br><br>hash2 =<span class="token punctuation">:</span><span class="token punctuation">:</span><br>  <span class="token key atrule">bar</span><span class="token punctuation">:</span> three<br><br>test<span class="token punctuation">:</span><span class="token punctuation">:</span><br><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Test merge<br>  <span class="token key atrule">code</span><span class="token punctuation">:</span> hash1.merge(hash2)<br>  <span class="token key atrule">want</span><span class="token punctuation">:</span><br>    <span class="token key atrule">foo</span><span class="token punctuation">:</span> one<br>    <span class="token key atrule">bar</span><span class="token punctuation">:</span> three<br><br><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Count keys<br>  <span class="token key atrule">code</span><span class="token punctuation">:</span> hash1.keys().count()<br>  <span class="token key atrule">want</span><span class="token punctuation">:</span> <span class="token number">2</span><br><br><span class="token key atrule">done</span><span class="token punctuation">:</span> <span class="token number">2</span>     <span class="token comment"># Make sure we ran 2 tests</span></code></pre><p>We can run this test file with the common <code>prove</code> command:</p><pre class="language-sh"><code class="language-sh">$ prove <span class="token parameter variable">-v</span> test-1.t<br>test-1.t <span class="token punctuation">..</span><br>ok <span class="token number">1</span> - Test merge<br>ok <span class="token number">2</span> - Count keys<br><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">2</span><br>ok<br>All tests successful.<br><span class="token assign-left variable">Files</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">Tests</span><span class="token operator">=</span><span class="token number">2</span>,  <span class="token number">0</span> wallclock secs <span class="token punctuation">(</span> <span class="token number">0.01</span> usr  <span class="token number">0.00</span> sys +  <span class="token number">0.01</span> cusr  <span class="token number">0.00</span> csys <span class="token operator">=</span>  <span class="token number">0.02</span> CPU<span class="token punctuation">)</span><br>Result: PASS</code></pre><p>Tests are defined as a simple YAML sequence of mappings, one for each test. The <code>test</code> functions takes this sequence and runs each test in order.</p><p>TAP needs to know that all the tests you intended to run were run. You can do this by calling the <code>plan</code> function beforehand with the number of tests you intend to run, or by calling the <code>done</code> afterwards with the number of tests you intended to run. You can also call <code>done</code> with no arguments (<code>done:</code>) to indicate that all tests were run.</p><h2>Test Mappings</h2><p>Each test mapping has certain keys that determine how the test is run.</p><p>You must specify <code>code</code> or <code>cmnd</code> for each test. This indicates either the YAMLScript code to run or the CLI command to run.</p><p>You must specify one of <code>want</code>, <code>like</code> or <code>have</code> for each test. This indicates how the result should be tested.</p><p>Here are the test mapping keys you can use in a test:</p><ul><li><p><code>name</code> — The name/description of the test. This is optional.</p></li><li><p><code>code</code> — The YAMLScript code to run for the test.</p></li><li><p><code>cmnd</code> — The CLI command to run for the test.</p></li><li><p><code>want</code> — The exact expected result of the test.</p></li><li><p><code>like</code> — A regex pattern that the result should match.</p></li><li><p><code>have</code> — A substring that the result should contain.</p></li><li><p><code>what</code> — What part of the result to test. Can be set to <code>value</code>, <code>error</code> or <code>out</code> for <code>code</code> tests and defaults to <code>value</code>. Can be set to <code>out</code>, <code>err</code>, <code>exit</code> or <code>all</code> for <code>cmnd</code> tests and defaults to <code>out</code>. See below for more information on these <code>what</code> values.</p></li><li><p><code>form</code> — A function to format the result for testing. The function will be called with the full result data and the current test object.</p></li><li><p><code>SKIP</code> — If set to <code>true</code>, this test will be skipped. Can be used on multiple tests.</p></li><li><p><code>ONLY</code> — If set to <code>true</code> only this test will be run. Can be used on multiple tests.</p></li></ul><h3>The <code>what</code> Values</h3><ul><li><p><code>value</code> — Test the return value of the code. This is the default for <code>code</code> tests.</p></li><li><p><code>error</code> — Test the error message of the code. This expects the code to throw an error.</p></li><li><p><code>out</code> — Test the stdout of the command.</p></li><li><p><code>err</code> — Test the stderr of the command.</p></li><li><p><code>exit</code> — Test the exit code of the command.</p></li><li><p><code>all</code> — An object containing <code>out</code>, <code>err</code> and <code>exit</code> values.</p></li></ul><h2>The ys::taptest API Functions</h2><ul><li><p><code>done</code> — Indicate that a certain number of tests were run. Run this after running all tests.</p></li><li><p><code>plan</code> — Plan to run a certain number of tests. Run this before running any tests.</p></li><li><p><code>test</code> — Run a sequence of tests.</p></li></ul></main><aside class="post__aside"><nav class="post__pagination"></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>