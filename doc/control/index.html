<!doctype html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-44C9DS3Q80"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-44C9DS3Q80');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/doc/control/"><link href="/assets/main.089cde16aad3ee63f22f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Control Flow | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Control Flow"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/doc/control/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="Control Flow YAMLScript (iow Clojure) is a functional programming language. That means that everything is a function. Running a program is..."><meta property="og:description" content="Control Flow YAMLScript (iow Clojure) is a functional programming language. That means that everything is a function. Running a program is..."><meta name="description" content="Control Flow YAMLScript (iow Clojure) is a functional programming language. That means that everything is a function. Running a program is..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript-logo.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/doc">Docs</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Control Flow</h1></header><main class="post__content"><p>YAMLScript (iow Clojure) is a functional programming language. That means that everything is a function. Running a program is just a calling a function that calls other functions.</p><p>Even though YAMLScript tries hard to look like an imperative language, you must keep in mind that it's functional and get familiar with how the flow works.</p><p>This document will cover:</p><ul><li>Starting a program</li><li>Variable scope</li><li>Grouping expressions</li><li>Looping functions and recursion</li><li>Conditional expressions</li></ul><blockquote><p>Note: Some of the things that are called &quot;functions&quot; in in this document are actually &quot;macros&quot; or &quot;special forms&quot; in Clojure. The distinction is not particularly important here, but worth mentioning.</p></blockquote><h2>Starting a Program</h2><p>A YAMLScript file generally is just a bunch of <code>defn</code> calls to define functions.</p><p>Sometimes there will be assignment expressions at the top level. Top level variables are global and can be used anywhere in the program. They belong to the file's namespace which is <code>main</code> by default.</p><p>If a program defines a function called <code>main</code>, it will be called when the program is run. Any command line arguments will be passed to the <code>main</code> function after being cast to numbers if they look like numbers.</p><p><code>program.ys</code>:</p><pre class="language-yaml"><code class="language-yaml"><span class="token tag">!yamlscript/v0</span><br><br>defn main(word='Hello<span class="token tag">!'</span> times=3)<br>  <span class="token key atrule">for i (1 .. times)</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">"$i) $word"</span></code></pre><pre class="language-sh"><code class="language-sh">$ ys program.ys<br><span class="token number">1</span><span class="token punctuation">)</span> Hello<span class="token operator">!</span><br><span class="token number">2</span><span class="token punctuation">)</span> Hello<span class="token operator">!</span><br><span class="token number">3</span><span class="token punctuation">)</span> Hello<span class="token operator">!</span></code></pre><pre class="language-sh"><code class="language-sh">$ ys program.ys YAMLScript <span class="token number">2</span><br><span class="token number">1</span><span class="token punctuation">)</span> YAMLScript<br><span class="token number">2</span><span class="token punctuation">)</span> YAMLScript</code></pre><p>If a program does not define a <code>main</code> function, then nothing will happen unless you've defined a top level function call yourself. YAMLScript files that are meant to be used as libraries will not have a <code>main</code> function or a top level function call.</p><h2>Variable Scope</h2><p>One cool thing about YAMLScript (and Clojure) is that you can use any word as a variable name. Even things like <code>if</code> and <code>for</code> which are reserved words in many languages.</p><p>For example you might do this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">defn foo(list)</span><span class="token punctuation">:</span><br>  <span class="token key atrule">count =</span><span class="token punctuation">:</span> count(list)<br>  <span class="token key atrule">if count > 0</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'The list is not empty'</span><br>  <span class="token key atrule">else</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'The list is empty'</span></code></pre><p>Once we bind <code>count</code> to the result of the <code>count</code> function, we can't use the <code>count</code> function again in that scope. Often this is just fine. And it feels nice that you don't have to think up a synonym or alternative mangling for <code>count</code>.</p><h2>Grouping Expressions</h2><p>Some expression contexts allow multiple expressions to be grouped together and some only allow a single expression.</p><p>You can group multiple expressions together with a <code>do</code> function call when you need to to do multiple things in a context that only allows a single expression.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">if a > b</span><span class="token punctuation">:</span><br>  <span class="token key atrule">do</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'a is greater than b'</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'a must be HUGE!'</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'Nothing to see here'</span></code></pre><blockquote><p>Note: The <code>if</code> function actually supports the better named <code>then</code> and <code>else</code> words for grouping, but <code>do</code> can also be used.</p></blockquote><h2>Looping Functions and Recursion</h2><p>YAMLScript has a few looping functions: <code>loop</code>, <code>reduce</code>, <code>for</code> and <code>each</code>.</p><p>These will be documented in more detail in the future, but for now you can see the Clojure documentation for them:</p><ul><li><a href="https://clojuredocs.org/clojure.core/loop">loop</a></li><li><a href="https://clojuredocs.org/clojure.core/reduce">reduce</a></li><li><a href="https://clojuredocs.org/clojure.core/for">for</a></li><li><code>each</code> is a YAMLScript function that calls to a <code>for</code> expression inside a <code>doall</code> expression. This allows you to print things in the loop body. In every other way it's the same as <code>for</code>.</li></ul><h2>Conditional Expressions</h2><p>YAMLScript has a few common conditional expressions: <code>if</code>, <code>when</code>, <code>cond</code> and <code>case</code>.</p><h3>The <code>if</code> Function</h3><p>In YAMLScript, an <code>if</code> expression is a function that takes 3 arguments: a condition, a then expression and an else expression.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">if a</span><span class="token punctuation">:</span> b c  <span class="token comment"># If a is true, return b, else return c</span></code></pre><p>The <code>b</code> and <code>c</code> expressions can also be mapping pairs:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">if a</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'yes'</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'no'</span></code></pre><p>Sometimes you want to do more than one thing in the then or else expression:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">if a</span><span class="token punctuation">:</span><br>  <span class="token key atrule">then</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'yes'</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'yes'</span><br>  <span class="token key atrule">else</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'no'</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'no'</span></code></pre><p>If you use <code>then</code> you must also use <code>else</code>, but <code>else</code> can be used without a <code>then</code>:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">if a</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'yes'</span><br>  <span class="token key atrule">else</span><span class="token punctuation">:</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'no'</span><br>    <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'no'</span></code></pre><p>Since <code>if</code> is a function, it has a return value.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">say</span><span class="token punctuation">:</span><br>  <span class="token key atrule">if a</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>'yes' 'no'</code></pre><p>Any variable assigned in the <code>then</code> or <code>else</code> expression will only apply to that expression and not to the surrounding scope.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">x =</span><span class="token punctuation">:</span> <span class="token number">1</span><br><span class="token key atrule">if a > b</span><span class="token punctuation">:</span><br>  <span class="token key atrule">x =</span><span class="token punctuation">:</span> <span class="token number">2</span><br>  <span class="token key atrule">x =</span><span class="token punctuation">:</span> <span class="token number">3</span><br><span class="token key atrule">=></span><span class="token punctuation">:</span> x    <span class="token comment"># => 1</span></code></pre><p>What you want to do here is capture the result of the <code>if</code> expression:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">x =</span><span class="token punctuation">:</span><br>  <span class="token key atrule">if a > b</span><span class="token punctuation">:</span><br>    <span class="token key atrule">then</span><span class="token punctuation">:</span> <span class="token number">2</span><br>    <span class="token key atrule">else</span><span class="token punctuation">:</span> <span class="token number">3</span><br><span class="token key atrule">=></span><span class="token punctuation">:</span> x    <span class="token comment"># => 2 or 3</span></code></pre><p>Note that <code>say</code> returns <code>nil</code>, so all the <code>if</code> expressions above would also return <code>nil</code>.</p><h3>The <code>when</code> Function</h3><p>YAMLScript also has a <code>when</code> function that is like <code>if</code> but without an else expression.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">when a</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'yes'</span></code></pre><p>The <code>if</code> function should only be used wen you have a then and an else expression. Otherwise, use <code>when</code>.</p><p>One thing about <code>when</code> is that its body can have multiple expressions.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">when a</span><span class="token punctuation">:</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'yes'</span><br>  <span class="token key atrule">say</span><span class="token punctuation">:</span> <span class="token string">'yes'</span></code></pre><h3>The <code>cond</code> Function</h3><p>The <code>cond</code> function is like a series of <code>if</code> expressions but with multiple conditions.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">size =</span><span class="token punctuation">:</span><br>  <span class="token key atrule">cond</span><span class="token punctuation">:</span><br>    <span class="token key atrule">a &lt; 20</span><span class="token punctuation">:</span>  <span class="token string">'small'</span><br>    <span class="token key atrule">a &lt; 50</span><span class="token punctuation">:</span>  <span class="token string">'medium'</span><br>    <span class="token key atrule">a &lt; 100</span><span class="token punctuation">:</span> <span class="token string">'large'</span><br>    <span class="token key atrule">else</span><span class="token punctuation">:</span>    <span class="token string">'huge'</span></code></pre><h3>The <code>case</code> Function</h3><p>The <code>case</code> function is like a <code>cond</code> but with a single expression to compare against.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">count =</span><span class="token punctuation">:</span><br>  <span class="token key atrule">case a</span><span class="token punctuation">:</span><br>    <span class="token key atrule">1</span><span class="token punctuation">:</span> <span class="token string">'one'</span><br>    <span class="token key atrule">2</span><span class="token punctuation">:</span> <span class="token string">'two'</span><br>    <span class="token key atrule">3</span><span class="token punctuation">:</span> <span class="token string">'three'</span><br>    <span class="token key atrule">else</span><span class="token punctuation">:</span> <span class="token string">'many'</span></code></pre></main><aside class="post__aside"><nav class="post__pagination"></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>